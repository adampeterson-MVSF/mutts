{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/test-endpoints.ts"],"sourcesContent":["import type { NextRequest, NextResponse } from \"next/server\";\n\nconst TEST_SECRET = process.env.TEST_SECRET || \"test-secret-default\";\n\n// Check if test affordances are enabled (matches middleware logic)\nconst isTrue = (v?: string) => v === \"1\" || v?.toLowerCase() === \"true\";\nfunction testAffordancesEnabled(): boolean {\n  // Allow only in test environment WHEN explicitly enabled.\n  const enabled =\n    isTrue(process.env.EXPOSE_TEST_API) || isTrue(process.env.ALLOW_TEST_ENDPOINTS);\n  const isTestEnv = process.env.NODE_ENV === \"test\";\n  return enabled && isTestEnv;\n}\n\nexport function isAllowedTestRequest(req: NextRequest) {\n  const enabled = testAffordancesEnabled();\n  const secret = req.headers.get(\"x-test-secret\") || \"\";\n  return enabled && secret === TEST_SECRET;\n}\n\nexport function blockAs404(): NextResponse {\n  return new Response(\"Not Found\", { status: 404 }) as unknown as NextResponse;\n}\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C,mEAAmE;AACnE,MAAM,SAAS,CAAC,IAAe,MAAM,OAAO,GAAG,kBAAkB;AACjE,SAAS;IACP,0DAA0D;IAC1D,MAAM,UACJ,OAAO,QAAQ,GAAG,CAAC,eAAe,KAAK,OAAO,QAAQ,GAAG,CAAC,oBAAoB;IAChF,MAAM,YAAY,oDAAyB;IAC3C,OAAO,WAAW;AACpB;AAEO,SAAS,qBAAqB,GAAgB;IACnD,MAAM,UAAU;IAChB,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;IACnD,OAAO,WAAW,WAAW;AAC/B;AAEO,SAAS;IACd,OAAO,IAAI,SAAS,aAAa;QAAE,QAAQ;IAAI;AACjD","debugId":null}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/env-server.ts"],"sourcesContent":["import { z } from \"zod\";\n\nconst ServerEnvSchema = z.object({\n  NODE_ENV: z.enum([\"development\", \"test\", \"production\"]),\n  ALLOW_TEST_ENDPOINTS: z.string().optional(), // must be '1' AND NODE_ENV==='test'\n\n  // Database\n  DATABASE_URL: z.string().url(),\n\n  // Supabase\n  SUPABASE_SERVICE_ROLE_KEY: z.string().min(1),\n\n  // Optional monitoring\n  SENTRY_DSN: z.string().url().optional(),\n\n  // Test configuration\n  TEST_SECRET: z.string().optional(),\n\n  // PII encryption\n  FIELD_ENCRYPTION_KEY: z.string().min(1, \"FIELD_ENCRYPTION_KEY is required for PII encryption\"),\n  FIELD_ENCRYPTION_SALT: z.string().optional(),\n}).superRefine((env, ctx) => {\n  // Validate FIELD_ENCRYPTION_KEY format (should be base64-encoded 32 bytes)\n  if (env.FIELD_ENCRYPTION_KEY) {\n    try {\n      const key = Buffer.from(env.FIELD_ENCRYPTION_KEY, 'base64');\n      if (key.length !== 32) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: \"FIELD_ENCRYPTION_KEY must be a base64-encoded 32-byte key\"\n        });\n      }\n    } catch {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"FIELD_ENCRYPTION_KEY must be valid base64\"\n      });\n    }\n  }\n\n  // Test affordances can only be enabled in test environment OR when explicitly allowed\n  // This allows test endpoints to work during E2E testing even if NODE_ENV != test\n  if (env.NODE_ENV !== \"test\" && env.ALLOW_TEST_ENDPOINTS !== \"1\") {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: \"Test affordances cannot be enabled outside test environment unless ALLOW_TEST_ENDPOINTS=1\"\n    });\n  }\n\n  // Test secret should only be set in development/test or when test affordances are enabled\n  if (env.NODE_ENV === \"production\" && env.TEST_SECRET && env.ALLOW_TEST_ENDPOINTS !== \"1\") {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: \"TEST_SECRET should not be set in production unless ALLOW_TEST_ENDPOINTS=1\"\n    });\n  }\n});\n\n// Validate server-side environment variables\nexport const serverEnv = ServerEnvSchema.parse({\n  ...process.env,\n  NODE_ENV: process.env.NODE_ENV || \"development\",\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB,oLAAC,CAAC,MAAM,CAAC;IAC/B,UAAU,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAQ;KAAa;IACtD,sBAAsB,oLAAC,CAAC,MAAM,GAAG,QAAQ;IAEzC,WAAW;IACX,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG;IAE5B,WAAW;IACX,2BAA2B,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAE1C,sBAAsB;IACtB,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IAErC,qBAAqB;IACrB,aAAa,oLAAC,CAAC,MAAM,GAAG,QAAQ;IAEhC,iBAAiB;IACjB,sBAAsB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxC,uBAAuB,oLAAC,CAAC,MAAM,GAAG,QAAQ;AAC5C,GAAG,WAAW,CAAC,CAAC,KAAK;IACnB,2EAA2E;IAC3E,IAAI,IAAI,oBAAoB,EAAE;QAC5B,IAAI;YACF,MAAM,MAAM,OAAO,IAAI,CAAC,IAAI,oBAAoB,EAAE;YAClD,IAAI,IAAI,MAAM,KAAK,IAAI;gBACrB,IAAI,QAAQ,CAAC;oBACX,MAAM,oLAAC,CAAC,YAAY,CAAC,MAAM;oBAC3B,SAAS;gBACX;YACF;QACF,EAAE,OAAM;YACN,IAAI,QAAQ,CAAC;gBACX,MAAM,oLAAC,CAAC,YAAY,CAAC,MAAM;gBAC3B,SAAS;YACX;QACF;IACF;IAEA,sFAAsF;IACtF,iFAAiF;IACjF,IAAI,IAAI,QAAQ,KAAK,UAAU,IAAI,oBAAoB,KAAK,KAAK;QAC/D,IAAI,QAAQ,CAAC;YACX,MAAM,oLAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;QACX;IACF;IAEA,0FAA0F;IAC1F,IAAI,IAAI,QAAQ,KAAK,gBAAgB,IAAI,WAAW,IAAI,IAAI,oBAAoB,KAAK,KAAK;QACxF,IAAI,QAAQ,CAAC;YACX,MAAM,oLAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;QACX;IACF;AACF;AAGO,MAAM,YAAY,gBAAgB,KAAK,CAAC;IAC7C,GAAG,QAAQ,GAAG;IACd,UAAU,mDAAwB;AACpC","debugId":null}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { serverEnv } from './env-server'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n    datasources: {\n      db: {\n        url: `${serverEnv.DATABASE_URL}?connection_limit=5&pool_timeout=20`,\n      },\n    },\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;IAC3E,aAAa;QACX,IAAI;YACF,KAAK,GAAG,mIAAS,CAAC,YAAY,CAAC,mCAAmC,CAAC;QACrE;IACF;AACF;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/prisma.ts"],"sourcesContent":["export { prisma } from './db'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/utils/dog-utils.ts"],"sourcesContent":["import { DogSize } from \"@prisma/client\";\n\nexport function calculateAge(dob: Date | null | undefined): number | null {\n  if (!dob) return null;\n\n  const diff = Date.now() - new Date(dob).getTime();\n  const ageDate = new Date(diff);\n\n  return Math.abs(ageDate.getUTCFullYear() - 1970);\n}\n\nexport function isSenior(dob: Date | null | undefined): boolean {\n  const age = calculateAge(dob);\n  // Default to 'true' for seniors if age is unknown, as this is a senior dog rescue.\n  return (age || 8) >= 8;\n}\n\nexport function getSizeFromWeight(weight: number | null | undefined): DogSize {\n  if (!weight) return DogSize.UNKNOWN;\n\n  if (weight < 8) return DogSize.TOY;\n  if (weight < 20) return DogSize.SMALL;\n  if (weight < 45) return DogSize.MEDIUM;\n\n  return DogSize.LARGE;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS,aAAa,GAA4B;IACvD,IAAI,CAAC,KAAK,OAAO;IAEjB,MAAM,OAAO,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,OAAO;IAC/C,MAAM,UAAU,IAAI,KAAK;IAEzB,OAAO,KAAK,GAAG,CAAC,QAAQ,cAAc,KAAK;AAC7C;AAEO,SAAS,SAAS,GAA4B;IACnD,MAAM,MAAM,aAAa;IACzB,mFAAmF;IACnF,OAAO,CAAC,OAAO,CAAC,KAAK;AACvB;AAEO,SAAS,kBAAkB,MAAiC;IACjE,IAAI,CAAC,QAAQ,OAAO,wIAAO,CAAC,OAAO;IAEnC,IAAI,SAAS,GAAG,OAAO,wIAAO,CAAC,GAAG;IAClC,IAAI,SAAS,IAAI,OAAO,wIAAO,CAAC,KAAK;IACrC,IAAI,SAAS,IAAI,OAAO,wIAAO,CAAC,MAAM;IAEtC,OAAO,wIAAO,CAAC,KAAK;AACtB","debugId":null}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/app/api/test-api/health/route.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from 'next/server';\nimport { isAllowedTestRequest, blockAs404 } from '@/lib/test-endpoints';\nimport { prisma } from '@/lib/prisma';\nimport { calculateAge } from '@/lib/utils/dog-utils';\n\nexport async function GET(request: Request) {\n  if (!isAllowedTestRequest(request as unknown as NextRequest)) return blockAs404();\n\n  try {\n    // Get comprehensive dataset statistics\n    const [\n      dogs,\n      profiles,\n      shifts,\n      shiftSignups,\n    ] = await Promise.all([\n      prisma.dog.findMany({\n        select: {\n          status: true,\n          primaryPhotoUrl: true,\n          dateOfBirth: true,\n          size: true,\n          specialNeeds: true,\n          breed: true\n        }\n      }),\n      prisma.profile.findMany({ select: { role: true } }),\n      prisma.shift.count(),\n      prisma.volunteerShiftSignup.count(),\n    ]);\n\n    // Calculate statistics matching seed summary format\n    // Compute derived values from source fields\n    const dogStats = {\n      total: dogs.length,\n      withPhotos: dogs.filter(d => d.primaryPhotoUrl && !d.primaryPhotoUrl.includes('placeholder')).length,\n      seniors: dogs.filter(d => calculateAge(d.dateOfBirth) !== null && calculateAge(d.dateOfBirth)! >= 8).length, // 8+ years\n      age: dogs.reduce((acc, dog) => {\n        const age = calculateAge(dog.dateOfBirth);\n        if (age !== null) {\n          let bucket: string;\n          if (age < 1) bucket = 'puppy'; // Less than 1 year\n          else if (age < 8) bucket = 'adult'; // 1-7 years\n          else bucket = 'senior'; // 8+ years\n          acc[bucket] = (acc[bucket] || 0) + 1;\n        }\n        return acc;\n      }, {} as Record<string, number>),\n      size: dogs.reduce((acc, dog) => {\n        if (dog.size) {\n          // Map DogSize enum to bucket names\n          let bucket: string;\n          if (dog.size === 'TOY' || dog.size === 'SMALL') bucket = 'small';\n          else if (dog.size === 'MEDIUM') bucket = 'medium';\n          else if (dog.size === 'LARGE') bucket = 'large';\n          else bucket = dog.size.toLowerCase();\n          acc[bucket] = (acc[bucket] || 0) + 1;\n        }\n        return acc;\n      }, {} as Record<string, number>),\n      breeds: dogs.reduce((acc, dog) => {\n        if (dog.breed) {\n          acc[dog.breed] = (acc[dog.breed] || 0) + 1;\n        }\n        return acc;\n      }, {} as Record<string, number>),\n      specialNeeds: dogs.filter(d => d.specialNeeds).length,\n    };\n\n    const profileStats = {\n      total: profiles.length,\n      byRole: profiles.reduce((acc, profile) => {\n        acc[profile.role] = (acc[profile.role] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>),\n    };\n\n    return NextResponse.json({\n      dataset: 'realistic', // Assume realistic for test environment\n      summary: {\n        dogs: {\n          total: dogStats.total,\n          withPhotos: dogStats.withPhotos,\n          age: dogStats.age,\n          size: dogStats.size,\n          breeds: dogStats.breeds,\n          specialNeeds: dogStats.specialNeeds,\n        },\n        volunteers: {\n          total: profileStats.total,\n          staff: profileStats.byRole['STAFF'] || 0,\n          admins: profileStats.byRole['ADMIN'] || 0,\n        },\n        shifts: {\n          total: shifts,\n          signups: shiftSignups,\n        },\n      },\n    });\n  } catch (error) {\n    console.error('Health check failed:', error);\n    return NextResponse.json({\n      ok: false,\n      error: 'Database health check failed'\n    }, { status: 500 });\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}