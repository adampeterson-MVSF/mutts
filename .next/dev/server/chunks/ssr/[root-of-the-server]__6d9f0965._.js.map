{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/env-server.ts"],"sourcesContent":["import { z } from \"zod\";\n\nconst ServerEnvSchema = z.object({\n  NODE_ENV: z.enum([\"development\", \"test\", \"production\"]),\n  ALLOW_TEST_ENDPOINTS: z.string().optional(), // must be '1' AND NODE_ENV==='test'\n\n  // Database\n  DATABASE_URL: z.string().url(),\n\n  // Supabase\n  SUPABASE_SERVICE_ROLE_KEY: z.string().min(1),\n\n  // Optional monitoring\n  SENTRY_DSN: z.string().url().optional(),\n\n  // Test configuration\n  TEST_SECRET: z.string().optional(),\n\n  // PII encryption\n  FIELD_ENCRYPTION_KEY: z.string().min(1, \"FIELD_ENCRYPTION_KEY is required for PII encryption\"),\n  FIELD_ENCRYPTION_SALT: z.string().optional(),\n}).superRefine((env, ctx) => {\n  // Validate FIELD_ENCRYPTION_KEY format (should be base64-encoded 32 bytes)\n  if (env.FIELD_ENCRYPTION_KEY) {\n    try {\n      const key = Buffer.from(env.FIELD_ENCRYPTION_KEY, 'base64');\n      if (key.length !== 32) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: \"FIELD_ENCRYPTION_KEY must be a base64-encoded 32-byte key\"\n        });\n      }\n    } catch {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"FIELD_ENCRYPTION_KEY must be valid base64\"\n      });\n    }\n  }\n\n  // Test affordances can only be enabled in test environment OR when explicitly allowed\n  // This allows test endpoints to work during E2E testing even if NODE_ENV != test\n  if (env.NODE_ENV !== \"test\" && env.ALLOW_TEST_ENDPOINTS !== \"1\") {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: \"Test affordances cannot be enabled outside test environment unless ALLOW_TEST_ENDPOINTS=1\"\n    });\n  }\n\n  // Test secret should only be set in development/test or when test affordances are enabled\n  if (env.NODE_ENV === \"production\" && env.TEST_SECRET && env.ALLOW_TEST_ENDPOINTS !== \"1\") {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: \"TEST_SECRET should not be set in production unless ALLOW_TEST_ENDPOINTS=1\"\n    });\n  }\n});\n\n// Validate server-side environment variables\nexport const serverEnv = ServerEnvSchema.parse({\n  ...process.env,\n  NODE_ENV: process.env.NODE_ENV || \"development\",\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB,kLAAC,CAAC,MAAM,CAAC;IAC/B,UAAU,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAe;QAAQ;KAAa;IACtD,sBAAsB,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAEzC,WAAW;IACX,cAAc,kLAAC,CAAC,MAAM,GAAG,GAAG;IAE5B,WAAW;IACX,2BAA2B,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAE1C,sBAAsB;IACtB,YAAY,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IAErC,qBAAqB;IACrB,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAEhC,iBAAiB;IACjB,sBAAsB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxC,uBAAuB,kLAAC,CAAC,MAAM,GAAG,QAAQ;AAC5C,GAAG,WAAW,CAAC,CAAC,KAAK;IACnB,2EAA2E;IAC3E,IAAI,IAAI,oBAAoB,EAAE;QAC5B,IAAI;YACF,MAAM,MAAM,OAAO,IAAI,CAAC,IAAI,oBAAoB,EAAE;YAClD,IAAI,IAAI,MAAM,KAAK,IAAI;gBACrB,IAAI,QAAQ,CAAC;oBACX,MAAM,kLAAC,CAAC,YAAY,CAAC,MAAM;oBAC3B,SAAS;gBACX;YACF;QACF,EAAE,OAAM;YACN,IAAI,QAAQ,CAAC;gBACX,MAAM,kLAAC,CAAC,YAAY,CAAC,MAAM;gBAC3B,SAAS;YACX;QACF;IACF;IAEA,sFAAsF;IACtF,iFAAiF;IACjF,IAAI,IAAI,QAAQ,KAAK,UAAU,IAAI,oBAAoB,KAAK,KAAK;QAC/D,IAAI,QAAQ,CAAC;YACX,MAAM,kLAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;QACX;IACF;IAEA,0FAA0F;IAC1F,IAAI,IAAI,QAAQ,KAAK,gBAAgB,IAAI,WAAW,IAAI,IAAI,oBAAoB,KAAK,KAAK;QACxF,IAAI,QAAQ,CAAC;YACX,MAAM,kLAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;QACX;IACF;AACF;AAGO,MAAM,YAAY,gBAAgB,KAAK,CAAC;IAC7C,GAAG,QAAQ,GAAG;IACd,UAAU,mDAAwB;AACpC","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { serverEnv } from './env-server'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n    datasources: {\n      db: {\n        url: `${serverEnv.DATABASE_URL}?connection_limit=5&pool_timeout=20`,\n      },\n    },\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;IAC3E,aAAa;QACX,IAAI;YACF,KAAK,GAAG,iIAAS,CAAC,YAAY,CAAC,mCAAmC,CAAC;QACrE;IACF;AACF;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/prisma.ts"],"sourcesContent":["export { prisma } from './db'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/env.ts"],"sourcesContent":["import { z } from \"zod\";\n\n// Client-safe environment variables (can be imported by client code)\nconst ClientEnvSchema = z.object({\n  NEXT_PUBLIC_SUPABASE_URL: z.string().url(),\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().min(1).optional(),\n  NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY: z.string().min(1).optional(),\n  NEXT_PUBLIC_SITE_URL: z.string().url(),\n});\n\n// Validate client-safe environment variables\nexport const clientEnv = ClientEnvSchema.parse({\n  NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,\n  NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n  NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY,\n  NEXT_PUBLIC_SITE_URL: process.env.NEXT_PUBLIC_SITE_URL,\n});\n\n// Helper to get the Supabase anon key (supports both naming conventions)\nexport const getSupabaseAnonKey = () => clientEnv.NEXT_PUBLIC_SUPABASE_ANON_KEY || clientEnv.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY!;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,qEAAqE;AACrE,MAAM,kBAAkB,kLAAC,CAAC,MAAM,CAAC;IAC/B,0BAA0B,kLAAC,CAAC,MAAM,GAAG,GAAG;IACxC,+BAA+B,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IACzD,sCAAsC,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IAChE,sBAAsB,kLAAC,CAAC,MAAM,GAAG,GAAG;AACtC;AAGO,MAAM,YAAY,gBAAgB,KAAK,CAAC;IAC7C,wBAAwB;IACxB,6BAA6B;IAC7B,oCAAoC;IACpC,oBAAoB;AACtB;AAGO,MAAM,qBAAqB,IAAM,UAAU,6BAA6B,IAAI,UAAU,oCAAoC","debugId":null}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\nimport { getSupabaseAnonKey } from \"@/lib/env\";\n\n// Type for test mock client\ntype MockSupabaseClient = {\n  auth: {\n    getUser: () => Promise<{ data: { user: null }; error: null }>;\n    verifyOtp: () => Promise<{ data: { user: null; session: null }; error: null }>;\n    signInWithPassword: () => Promise<{ error: null }>;\n  };\n  storage: {\n    from: () => {\n      upload: () => Promise<{ error: null }>;\n      download: () => Promise<{ data: null; error: null }>;\n      remove: () => Promise<{ error: null }>;\n      getPublicUrl: () => { data: { publicUrl: string } };\n      createSignedUrl: () => Promise<{ data: { signedUrl: string }; error: null }>;\n      createSignedUploadUrl: () => Promise<{ data: { signedUrl: string }; error: null }>;\n      list: () => Promise<{ data: unknown[]; error: null }>;\n    };\n  };\n};\n\n/**\n * Especially important if using Fluid compute: Don't put this client in a\n * global variable. Always create a new client within each function when using\n * it.\n */\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  // In test environment, return a mock client to prevent Supabase errors\n  // The test authentication is handled via headers, not cookies\n  if (process.env.NODE_ENV === 'test') {\n    return {\n      auth: {\n        getUser: async () => ({\n          data: { user: null },\n          error: null\n        }),\n        verifyOtp: async () => ({\n          data: { user: null, session: null },\n          error: null\n        }),\n        signInWithPassword: async () => ({ error: null })\n      },\n      storage: {\n        from: () => ({\n          upload: async () => ({ error: null }),\n          download: async () => ({ data: null, error: null }),\n          remove: async () => ({ error: null }),\n          getPublicUrl: () => ({ data: { publicUrl: '' } }),\n          createSignedUrl: async () => ({ data: { signedUrl: '' }, error: null }),\n          createSignedUploadUrl: async () => ({ data: { signedUrl: '' }, error: null }),\n          list: async () => ({ data: [], error: null })\n        })\n      }\n    } as MockSupabaseClient;\n  }\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    getSupabaseAnonKey(),\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options),\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    },\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;;;;AA2BO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,uEAAuE;IACvE,8DAA8D;IAC9D;;IA2BA,OAAO,IAAA,+LAAkB,gFAEvB,IAAA,gIAAkB,KAClB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/actions/profile.actions.ts"],"sourcesContent":["// lib/actions/profile.actions.ts\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\nimport { prisma } from \"@/lib/prisma\";\nimport { UserRole } from \"@prisma/client\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { z } from \"zod\";\nimport { ActionResult } from \"@/lib/types\";\n\nconst createProfileSchema = z.object({\n  name: z.string().optional(),\n});\n\n\n// Add this new function\nexport async function getActingUser(\n  { requireAuth = true }: { requireAuth?: boolean } = {}\n) {\n  // Check for synthetic session headers first (set by middleware)\n  const { headers } = await import('next/headers');\n  const headerData = await headers();\n  const testUserId = headerData.get('x-test-user-id');\n  const testUserRole = headerData.get('x-test-user-role');\n\n  if (testUserId && testUserRole) {\n    // Return a mock/partial User object based on headers\n    return {\n      id: testUserId,\n      email: `test-${testUserRole.toLowerCase()}@example.test`,\n      app_metadata: { role: testUserRole as UserRole },\n    } as {\n      id: string;\n      email: string;\n      app_metadata: { role: UserRole };\n    };\n  }\n\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (requireAuth && !user) {\n    redirect(\"/auth/login\");\n  }\n  return user;\n}\n\n// Add this new function\nexport async function requireRole(role: UserRole | UserRole[]) {\n  const user = await getActingUser();\n  if (!user) {\n    // This should be redundant due to getActingUser, but good for type safety\n    throw new Error(\"Authentication required.\");\n  }\n\n  const roles = Array.isArray(role) ? role : [role];\n  const userRole = await getActingUserRole(); // Assumes this queries the DB\n\n  // Role hierarchy: ADMIN can access everything\n  if (userRole === UserRole.ADMIN) {\n    return; // Admin has access to everything\n  }\n\n  if (!roles.includes(userRole)) {\n    throw new Error(\"Unauthorized.\");\n  }\n}\n\n// Defense-in-depth RBAC helper - throws on unauthorized access\nexport async function assertRole(requiredRoles: UserRole | UserRole[]): Promise<void> {\n  const user = await getActingUser();\n  if (!user) {\n    throw new Error(\"Authentication required.\");\n  }\n\n  const userRole = await getActingUserRole();\n  const roles = Array.isArray(requiredRoles) ? requiredRoles : [requiredRoles];\n\n  // ADMIN can access everything\n  if (userRole === UserRole.ADMIN) {\n    return;\n  }\n\n  if (!roles.includes(userRole)) {\n    throw new Error(\"Insufficient permissions.\");\n  }\n}\n\nexport async function createProfile(name: string) {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) { throw new Error(\"User not authenticated.\"); }\n\n  const parsed = createProfileSchema.safeParse({ name });\n  if (!parsed.success) {\n    throw new Error(parsed.error.issues[0]?.message ?? \"Invalid name\");\n  }\n\n  await prisma.profile.upsert({\n     where: { id: user.id },\n     update: { name: parsed.data.name, email: user.email }, // Update name/email if they exist\n     create: { id: user.id, email: user.email!, name: parsed.data.name },\n  });\n}\n\nexport async function updateUserRole(prevState: ActionResult, formData: FormData): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.ADMIN);\n\n    const userId = formData.get('userId') as string;\n    const role = formData.get('role') as UserRole;\n\n    if (!userId || !role) {\n      return {\n        success: false,\n        message: \"Missing required fields\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    // Protect \"last admin\" from demotion\n    const adminCount = await prisma.profile.count({ where: { role: 'ADMIN' } });\n    const user = await prisma.profile.findUnique({ where: { id: userId }, select: { role: true } });\n    if (!user) {\n      return {\n        success: false,\n        message: 'User not found',\n        fieldErrors: { userId: ['User not found'] },\n        data: null,\n      };\n    }\n    if (user.role === 'ADMIN' && role !== 'ADMIN' && adminCount <= 1) {\n      return {\n        success: false,\n        message: 'Cannot demote the last admin',\n        fieldErrors: { role: ['Cannot demote the last admin'] },\n        data: null,\n      };\n    }\n\n    await prisma.profile.update({ where: { id: userId }, data: { role } });\n    revalidatePath('/admin/users');\n    return {\n      success: true,\n      message: 'Role updated successfully',\n      fieldErrors: undefined,\n      data: null,\n    };\n  } catch {\n    return {\n      success: false,\n      message: \"Failed to update user role\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function getAllUsers() {\n  if (process.env.NODE_ENV !== 'test') {\n    await assertRole(UserRole.ADMIN);\n  }\n  return await prisma.profile.findMany({\n    orderBy: { email: \"asc\" },\n    select: {\n      id: true,\n      name: true,\n      email: true,\n      role: true,\n    },\n  });\n}\n\nexport async function getAllStaffUsers() {\n  if (process.env.NODE_ENV !== 'test') {\n    await assertRole(UserRole.STAFF);\n  }\n  return await prisma.profile.findMany({\n    where: {\n      role: {\n        in: [UserRole.STAFF, UserRole.ADMIN],\n      },\n    },\n    orderBy: { email: \"asc\" },\n    select: {\n      id: true,\n      name: true,\n      email: true,\n    },\n  });\n}\n\nexport async function getActingUserRole(): Promise<UserRole> {\n  // Check for synthetic session headers first (set by middleware)\n  const { headers } = await import('next/headers');\n  const headerData = await headers();\n  const testUserRole = headerData.get('x-test-user-role');\n\n  if (testUserRole && ['ADMIN', 'STAFF', 'VOLUNTEER'].includes(testUserRole)) {\n    return testUserRole as UserRole;\n  }\n\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    throw new Error(\"Not authenticated\");\n  }\n\n  const profile = await prisma.profile.findUnique({\n    where: { id: user.id },\n    select: { role: true },\n  });\n\n  if (!profile) {\n    throw new Error(\"Profile not found\");\n  }\n\n  return profile.role;\n}\n\nexport async function getUserProfile(userId: string) {\n  // Ensure user can only view their own profile (skip in test environment)\n  if (process.env.NODE_ENV !== 'test') {\n    const currentUser = await getActingUser();\n    if (!currentUser || currentUser.id !== userId) {\n      throw new Error(\"Unauthorized: Can only view your own profile\");\n    }\n  }\n\n  const parsed = z.object({ userId: z.string() }).safeParse({ userId });\n  if (!parsed.success) {\n    throw new Error(\"Invalid user ID\");\n  }\n\n  const profile = await prisma.profile.findUnique({\n    where: { id: userId },\n    select: {\n      name: true,\n      email: true,\n      role: true,\n      trainingCompleted: true,\n      backgroundCheckCompleted: true,\n      shiftCapacity: true,\n      prefersWeekdays: true,\n      prefersMornings: true,\n    },\n  });\n\n  // Return null if profile doesn't exist\n  return profile;\n}\n\nexport async function getUserSignupIds(userId: string) {\n  // Ensure user can only view their own signup IDs (skip in test environment)\n  if (process.env.NODE_ENV !== 'test') {\n    const currentUser = await getActingUser();\n    if (!currentUser || currentUser.id !== userId) {\n      throw new Error(\"Unauthorized: Can only view your own signups\");\n    }\n  }\n\n  const parsed = z.object({ userId: z.string() }).safeParse({ userId });\n  if (!parsed.success) {\n    throw new Error(\"Invalid user ID\");\n  }\n\n  try {\n    const userSignups = await prisma.volunteerShiftSignup.findMany({\n      where: { volunteerId: userId },\n      select: { shiftId: true }\n    });\n\n    return userSignups.map(signup => signup.shiftId);\n  } catch {\n    // Return empty array on any lookup failure (user doesn't exist, etc.)\n    return [];\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 573, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/utils/dog-utils.ts"],"sourcesContent":["import { DogSize } from \"@prisma/client\";\n\nexport function calculateAge(dob: Date | null | undefined): number | null {\n  if (!dob) return null;\n\n  const diff = Date.now() - new Date(dob).getTime();\n  const ageDate = new Date(diff);\n\n  return Math.abs(ageDate.getUTCFullYear() - 1970);\n}\n\nexport function isSenior(dob: Date | null | undefined): boolean {\n  const age = calculateAge(dob);\n  // Default to 'true' for seniors if age is unknown, as this is a senior dog rescue.\n  return (age || 8) >= 8;\n}\n\nexport function getSizeFromWeight(weight: number | null | undefined): DogSize {\n  if (!weight) return DogSize.UNKNOWN;\n\n  if (weight < 8) return DogSize.TOY;\n  if (weight < 20) return DogSize.SMALL;\n  if (weight < 45) return DogSize.MEDIUM;\n\n  return DogSize.LARGE;\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS,aAAa,GAA4B;IACvD,IAAI,CAAC,KAAK,OAAO;IAEjB,MAAM,OAAO,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,OAAO;IAC/C,MAAM,UAAU,IAAI,KAAK;IAEzB,OAAO,KAAK,GAAG,CAAC,QAAQ,cAAc,KAAK;AAC7C;AAEO,SAAS,SAAS,GAA4B;IACnD,MAAM,MAAM,aAAa;IACzB,mFAAmF;IACnF,OAAO,CAAC,OAAO,CAAC,KAAK;AACvB;AAEO,SAAS,kBAAkB,MAAiC;IACjE,IAAI,CAAC,QAAQ,OAAO,wIAAO,CAAC,OAAO;IAEnC,IAAI,SAAS,GAAG,OAAO,wIAAO,CAAC,GAAG;IAClC,IAAI,SAAS,IAAI,OAAO,wIAAO,CAAC,KAAK;IACrC,IAAI,SAAS,IAAI,OAAO,wIAAO,CAAC,MAAM;IAEtC,OAAO,wIAAO,CAAC,KAAK;AACtB","debugId":null}},
    {"offset": {"line": 605, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/zod/applicationSchema.ts"],"sourcesContent":["// lib/schemas/applicationSchema.ts\n\nimport { z } from \"zod\";\n\n// Profile fields (user account data)\nexport const profileSchema = z.object({\n  firstName: z.string().min(1, { message: \"First name is required.\" }),\n  lastName: z.string().min(1, { message: \"Last name is required.\" }),\n  email: z.string().email({ message: \"Please enter a valid email address.\" }),\n});\n\n// Applicant fields (application-specific data - moved from Profile to Application)\nexport const applicantSchema = z.object({\n  // --- Contact Fields ---\n  applicantPhone: z.string().optional(),\n\n  // --- Housing Fields ---\n  address: z.string().min(5, { message: \"Please enter a valid address.\" }),\n  housingType: z.enum([\"OWN_HOME\", \"RENT_HOME\", \"OWN_APT_CONDO\", \"RENT_APT_CONDO\", \"OTHER\"]),\n  hasYard: z.enum([\"YES\", \"NO\", \"SHARED\"]),\n  yardFenced: z.boolean(),\n  otherPets: z.string().optional(), // Description of other pets\n  vetName: z.string().optional(),\n  vetPhone: z.string().optional(),\n\n  // --- Home Environment Field ---\n  homeEnvironmentDescription: z.string().min(1, { message: \"Please describe your home environment.\" })\n});\n\nexport const applicationSchema = z.object({\n  // --- Application-specific Fields ---\n  reason: z.string().min(10, { message: \"Please provide a reason (min 10 characters).\" }),\n\n  // --- Relation IDs ---\n  dogId: z.number().int().positive().optional(),\n\n  // --- Reference Fields (relational data) ---\n  references: z.array(z.object({\n    name: z.string().min(1, \"Reference name is required.\"),\n    phone: z.string().optional(),\n    relationship: z.string().optional()\n  })).optional(),\n}).merge(applicantSchema.partial()); // Merge applicant fields as optional into application schema\n\nexport type ProfileFormData = z.infer<typeof profileSchema>;\nexport type ApplicationFormData = z.infer<typeof applicationSchema>;\nexport type ApplicantFormData = z.infer<typeof applicantSchema>;\n"],"names":[],"mappings":"AAAA,mCAAmC;;;;;;;;;AAEnC;;AAGO,MAAM,gBAAgB,kLAAC,CAAC,MAAM,CAAC;IACpC,WAAW,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAA0B;IAClE,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAyB;IAChE,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK,CAAC;QAAE,SAAS;IAAsC;AAC3E;AAGO,MAAM,kBAAkB,kLAAC,CAAC,MAAM,CAAC;IACtC,yBAAyB;IACzB,gBAAgB,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAEnC,yBAAyB;IACzB,SAAS,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAgC;IACtE,aAAa,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAY;QAAa;QAAiB;QAAkB;KAAQ;IACzF,SAAS,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAO;QAAM;KAAS;IACvC,YAAY,kLAAC,CAAC,OAAO;IACrB,WAAW,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,SAAS,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,UAAU,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAE7B,iCAAiC;IACjC,4BAA4B,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAyC;AACpG;AAEO,MAAM,oBAAoB,kLAAC,CAAC,MAAM,CAAC;IACxC,sCAAsC;IACtC,QAAQ,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI;QAAE,SAAS;IAA+C;IAErF,uBAAuB;IACvB,OAAO,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,QAAQ;IAE3C,6CAA6C;IAC7C,YAAY,kLAAC,CAAC,KAAK,CAAC,kLAAC,CAAC,MAAM,CAAC;QAC3B,MAAM,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QACxB,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ;QAC1B,cAAc,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACnC,IAAI,QAAQ;AACd,GAAG,KAAK,CAAC,gBAAgB,OAAO,KAAK,6DAA6D","debugId":null}},
    {"offset": {"line": 673, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/zod/shift.schema.ts"],"sourcesContent":["// lib/schemas/shift.schema.ts\n\nimport { z } from \"zod\";\n\nexport const shiftSchema = z.object({\n  title: z.string().transform(s => s.trim()).refine(Boolean, 'Title required'),\n  description: z.string().optional(),\n  startsAt: z.string().min(1, 'Start time is required')\n    .refine((val) => !isNaN(Date.parse(val)), 'Invalid start time format'),\n  endsAt: z.string().min(1, 'End time is required')\n    .refine((val) => !isNaN(Date.parse(val)), 'Invalid end time format'),\n  capacity: z.preprocess((val) => val === '' || val === null || val === undefined ? null : Number(val), z.number().int().positive().nullable()),\n}).superRefine((v, ctx) => {\n  if (new Date(v.endsAt) <= new Date(v.startsAt)) {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      path: ['endsAt'],\n      message: 'Start time must be before end time',\n    })\n  }\n})\n\nexport type ShiftFormData = z.infer<typeof shiftSchema>;\n"],"names":[],"mappings":"AAAA,8BAA8B;;;;;AAE9B;;AAEO,MAAM,cAAc,kLAAC,CAAC,MAAM,CAAC;IAClC,OAAO,kLAAC,CAAC,MAAM,GAAG,SAAS,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC,SAAS;IAC3D,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,0BACzB,MAAM,CAAC,CAAC,MAAQ,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO;IAC5C,QAAQ,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,wBACvB,MAAM,CAAC,CAAC,MAAQ,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO;IAC5C,UAAU,kLAAC,CAAC,UAAU,CAAC,CAAC,MAAQ,QAAQ,MAAM,QAAQ,QAAQ,QAAQ,YAAY,OAAO,OAAO,MAAM,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,QAAQ;AAC5I,GAAG,WAAW,CAAC,CAAC,GAAG;IACjB,IAAI,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,KAAK,EAAE,QAAQ,GAAG;QAC9C,IAAI,QAAQ,CAAC;YACX,MAAM,kLAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,MAAM;gBAAC;aAAS;YAChB,SAAS;QACX;IACF;AACF","debugId":null}},
    {"offset": {"line": 701, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/schemas.ts"],"sourcesContent":["import { DogStatus, LogType } from \"@prisma/client\";\nimport { z } from \"zod\";\n\nconst emptyStringToNull = (value: unknown) => {\n  if (value === null || value === undefined) return null;\n  const str = String(value).trim();\n  return str.length > 0 && str !== \"none\" ? str : null;\n};\n\n\nconst checkboxValue = (value: unknown) =>\n  value === true || value === \"true\" || value === \"on\";\n\nexport const dogFormSchema = z.object({\n  name: z.string().min(1, { message: \"Name is required.\" }),\n  status: z.nativeEnum(DogStatus).optional(),\n  breed: z.preprocess(emptyStringToNull, z.string().nullable()),\n  dateOfBirth: z\n    .preprocess((value) => {\n      if (!value || value === '' || typeof value !== 'string' && typeof value !== 'number' && !(value instanceof Date)) return null;\n      const date = new Date(value);\n      return isNaN(date.getTime()) ? null : date;\n    }, z.date().nullable())\n    .nullable(),\n  bioPublic: z.preprocess(emptyStringToNull, z.string().nullable()),\n  notesInternal: z.preprocess(emptyStringToNull, z.string().nullable()),\n  fosterProfileId: z.preprocess((value) => {\n    if (value === null || value === undefined) return null;\n    const str = String(value).trim();\n    if (str.length === 0 || str === \"none\") return null;\n    return str; // Profile ID is a string\n  }, z.string().nullable()),\n  specialNeeds: z.preprocess(checkboxValue, z.boolean()),\n}).refine((data) => {\n  if (data.status === DogStatus.IN_FOSTER) {\n    return data.fosterProfileId !== null && data.fosterProfileId !== undefined && data.fosterProfileId.trim() !== '';\n  }\n  return true;\n}, {\n  message: \"Foster profile is required when status is IN_FOSTER\",\n  path: [\"fosterProfileId\"],\n});\n\nexport type DogFormInput = z.infer<typeof dogFormSchema>;\n\nexport const logEntrySchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Dog ID is required.\" }),\n  logType: z.nativeEnum(LogType),\n  notes: z.preprocess(emptyStringToNull, z.string().nullable()),\n});\n\nexport type LogEntryInput = z.infer<typeof logEntrySchema>;\n\nexport const shiftIdSchema = z.object({\n  shiftId: z\n    .preprocess((value) => {\n      const num = Number(value);\n      return Number.isFinite(num) ? num : Number.NaN;\n    },\n    z\n      .number({ message: \"Invalid shift ID\" })\n      .int({ message: \"Invalid shift ID\" })\n      .positive({ message: \"Invalid shift ID\" })),\n});\n\nexport type ShiftIdInput = z.infer<typeof shiftIdSchema>;\n\nexport const eventFormSchema = z\n  .object({\n    title: z.string().min(1, { message: \"Title is required.\" }),\n    description: z.preprocess(emptyStringToNull, z.string().nullable()),\n    startTime: z.string().min(1, { message: \"Start time is required.\" }),\n    endTime: z.string().min(1, { message: \"End time is required.\" }),\n    location: z.preprocess(emptyStringToNull, z.string().nullable()),\n    capacity: z.preprocess(emptyStringToNull, z.coerce.number().int().positive().nullable()),\n  })\n  .refine(\n    (data) => {\n      const start = Date.parse(data.startTime);\n      const end = Date.parse(data.endTime);\n      return !Number.isNaN(start) && !Number.isNaN(end) && start < end;\n    },\n    {\n      message: \"End time must be after start time.\",\n      path: [\"endTime\"],\n    },\n  );\n\nexport type EventFormInput = z.infer<typeof eventFormSchema>;\n\nexport { applicationSchema } from \"./zod/applicationSchema\";\nexport { shiftSchema } from \"./zod/shift.schema\";\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 802, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/actions/audit.actions.ts"],"sourcesContent":["// lib/actions/audit.actions.ts\n\"use server\";\n\nimport { prisma } from \"@/lib/prisma\";\nimport { AuditAction, Prisma } from \"@prisma/client\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport interface AuditContext {\n  action: AuditAction;\n  entityType: string;\n  entityId: number;\n  actorId: string;\n  before?: Record<string, unknown>;\n  after?: Record<string, unknown>;\n  note?: string;\n}\n\n// Audit wrapper for server actions with retry safety\nexport async function withAudit<T>(\n  actionName: string,\n  userId: string,\n  operation: () => Promise<T>,\n  auditContext?: Partial<AuditContext>\n): Promise<T> {\n  const startTime = Date.now();\n  let attempts = 0;\n  const maxRetries = 3;\n\n  while (attempts < maxRetries) {\n    try {\n      const result = await operation();\n      const duration = Date.now() - startTime;\n\n      // Log successful operation\n      if (auditContext) {\n        try {\n          await prisma.auditLog.create({\n            data: {\n              action: auditContext.action!,\n              actorId: userId,\n              entityType: auditContext.entityType!,\n              entityId: auditContext.entityId!,\n              before: auditContext.before ? (auditContext.before as Prisma.InputJsonValue) : Prisma.JsonNull,\n              after: auditContext.after ? (auditContext.after as Prisma.InputJsonValue) : Prisma.JsonNull,\n              note: auditContext.note || `${actionName} completed in ${duration}ms`,\n            }\n          });\n        } catch {\n          // Silently skip audit logging failures (e.g., in tests without audit table)\n          // Don't log to console to avoid test noise\n        }\n      }\n\n      return result;\n    } catch (error: unknown) {\n      attempts++;\n\n      // Check if error is retryable (transient DB errors)\n      const isRetryable = error && typeof error === 'object' && 'code' in error &&\n                         (error.code === 'P2025' || // Record not found (might be race condition)\n                          error.code === 'P2002' || // Unique constraint violation (might be race condition)\n                          error.code === 'P2034' || // Transaction write conflict\n                          (error && typeof error === 'object' && 'message' in error && typeof error.message === 'string' && error.message.includes('connection')));\n\n      if (!isRetryable || attempts >= maxRetries) {\n        // Log failed operation\n        if (auditContext) {\n          try {\n            await prisma.auditLog.create({\n              data: {\n                action: auditContext.action!,\n                actorId: userId,\n                entityType: auditContext.entityType!,\n                entityId: auditContext.entityId!,\n              before: Prisma.JsonNull,\n              after: Prisma.JsonNull,\n                note: `${actionName} failed after ${attempts} attempts: ${error instanceof Error ? error.message : 'Unknown error'}`,\n              }\n            });\n          } catch {\n            // Silently skip audit logging failures (e.g., in tests without audit table)\n            // Don't log to console to avoid test noise\n          }\n        }\n\n        throw error;\n      }\n\n      // Exponential backoff: wait 100ms * 2^attempt\n      const backoffMs = 100 * Math.pow(2, attempts - 1);\n      console.warn(`${actionName} failed (attempt ${attempts}/${maxRetries}), retrying in ${backoffMs}ms:`, error && typeof error === 'object' && 'message' in error ? error.message : error);\n      await new Promise(resolve => setTimeout(resolve, backoffMs));\n    }\n  }\n\n  throw new Error(`Operation ${actionName} failed after ${maxRetries} attempts`);\n}\n\n// Helper to get current user from session\nexport async function getCurrentUserId(): Promise<string> {\n  const supabase = await createClient();\n  const { data, error } = await supabase.auth.getUser();\n  const user = data?.user;\n\n  if (error || !user) {\n    throw new Error('User not authenticated');\n  }\n\n  return user.id;\n}\n\n// Type-safe audit logging helpers - use these instead of raw AuditLog inserts\nexport async function logDogAudit(\n  dogId: number,\n  action: AuditAction,\n  actorId: string,\n  options: {\n    before?: Record<string, unknown>;\n    after?: Record<string, unknown>;\n    note?: string;\n  } = {}\n) {\n  return prisma.auditLog.create({\n    data: {\n      action,\n      actorId,\n      entityType: 'dog',\n      entityId: dogId,\n      before: options.before ? (options.before as Prisma.InputJsonValue) : Prisma.JsonNull,\n      after: options.after ? (options.after as Prisma.InputJsonValue) : Prisma.JsonNull,\n      note: options.note,\n    }\n  });\n}\n\nexport async function logApplicationAudit(\n  applicationId: number,\n  action: AuditAction,\n  actorId: string,\n  options: {\n    before?: Record<string, unknown>;\n    after?: Record<string, unknown>;\n    note?: string;\n  } = {}\n) {\n  return prisma.auditLog.create({\n    data: {\n      action,\n      actorId,\n      entityType: 'application',\n      entityId: applicationId,\n      before: options.before ? (options.before as Prisma.InputJsonValue) : Prisma.JsonNull,\n      after: options.after ? (options.after as Prisma.InputJsonValue) : Prisma.JsonNull,\n      note: options.note,\n    }\n  });\n}\n\n// Helper to capture before/after state for audit\nexport async function captureAuditState(entityType: string, entityId: number) {\n  switch (entityType) {\n    case 'dog':\n      const dog = await prisma.dog.findUnique({\n        where: { id: entityId },\n        select: {\n          id: true,\n          name: true,\n          status: true,\n          breed: true,\n          breedId: true, // Include new breedId field\n          dateOfBirth: true,\n          bioPublic: true,\n          notesInternal: true,\n          specialNeeds: true,\n          primaryPhotoUrl: true,\n          page_url: true,\n          mutt_id: true,\n          weight_lbs: true,\n          gender: true,\n          size: true,\n          fosterProfileId: true,\n        }\n      });\n      return dog;\n    case 'application':\n      const application = await prisma.application.findUnique({\n        where: { id: entityId },\n        select: {\n          id: true,\n          status: true,\n          statusNotes: true,\n          applicationType: true,\n          reason: true,\n          createdAt: true,\n          updatedAt: true,\n        }\n      });\n      return application;\n    default:\n      return null;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 988, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/actions/medical.actions.ts"],"sourcesContent":["// lib/actions/medical.actions.ts\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { prisma } from \"@/lib/prisma\";\nimport { MedicalRecordType, MedicalRecord, AuditAction } from \"@prisma/client\";\nimport { assertRole, getActingUser } from \"@/lib/actions/profile.actions\";\nimport { UserRole } from \"@prisma/client\";\nimport { ActionResult } from \"@/lib/types\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { z } from \"zod\";\nimport { getCurrentUserId } from \"@/lib/actions/audit.actions\";\n\n// File validation constants (mirror client-side validation)\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\nconst ALLOWED_EXTENSIONS = ['.pdf', '.jpg', '.jpeg', '.png', '.gif', '.webp', '.tiff', '.bmp'];\nconst ALLOWED_CONTENT_TYPES = [\n  'application/pdf',\n  'image/jpeg',\n  'image/jpg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n  'image/tiff',\n  'image/bmp',\n];\n\nconst uploadDocSchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n});\n\nconst deleteDocSchema = z.object({\n  documentId: z.coerce.number().int().positive({ message: \"Invalid document ID\" }),\n  storagePath: z.string().min(1, { message: \"Storage path is required\" }),\n});\n\nconst medicalRecordBaseSchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n  date: z.coerce.date({ message: \"Invalid date\" }),\n  type: z.nativeEnum(MedicalRecordType, { message: \"Invalid record type\" }),\n  notes: z.string().optional(),\n});\n\nconst vaccinationSchema = medicalRecordBaseSchema.extend({\n  type: z.literal(MedicalRecordType.VACCINATION),\n  vaccineType: z.string().min(1, { message: \"Vaccine type is required\" }),\n  nextDueDate: z.coerce.date().optional(),\n});\n\nconst medicationSchema = medicalRecordBaseSchema.extend({\n  type: z.literal(MedicalRecordType.MEDICATION),\n  medicationName: z.string().min(1, { message: \"Medication name is required\" }),\n  dosage: z.string().optional(),\n  frequency: z.string().optional(),\n});\n\nconst vetVisitSchema = medicalRecordBaseSchema.extend({\n  type: z.literal(MedicalRecordType.VET_VISIT),\n  vetName: z.string().optional(),\n  visitReason: z.string().min(1, { message: \"Visit reason is required\" }),\n});\n\nconst medicalRecordSchema = z.discriminatedUnion(\"type\", [\n  vaccinationSchema,\n  medicationSchema,\n  vetVisitSchema,\n]);\n\nconst deleteRecordSchema = z.object({\n  recordId: z.coerce.number().int().positive({ message: \"Invalid record ID\" }),\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n});\n\nconst getDocumentsSchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n});\n\n// Type for medical records with relations included\nexport type MedicalRecordWithRelations = MedicalRecord & {\n  vaccination: { id: number; medicalRecordId: number; vaccineType: string; nextDueDate: Date | null } | null;\n  medication: { id: number; medicalRecordId: number; medicationName: string; dosage: string | null; frequency: string | null } | null;\n  vetVisit: { id: number; medicalRecordId: number; vetName: string | null; visitReason: string | null } | null;\n};\n\n// Type for medical documents with signed URL\nexport type MedicalDocumentSummary = {\n  id: number;\n  dogId: number;\n  name: string;\n  mime: string;\n  size: number;\n  path: string;\n  uploadedByUserId: string;\n  createdAt: Date;\n  signedUrl: string | null;\n};\n\n// Define the shape of the form data for a medical record\nexport type MedicalRecordFormData = {\n  id?: number;\n  dogId: number;\n  date: Date;\n  type: MedicalRecordType;\n  notes: string | null;\n  // Nested satellite data\n  vaccination?: {\n    vaccineType: string;\n    nextDueDate?: Date | null;\n    lotNumber?: string | null;\n    vetName?: string | null;\n  } | null;\n  medication?: {\n    medicationName: string;\n    dosage?: string | null;\n    frequency?: string | null;\n  } | null;\n  vetVisit?: {\n    vetName?: string | null;\n    visitReason: string;\n  } | null;\n};\n\nexport async function createMedicalRecord(data: MedicalRecordFormData): Promise<ActionResult<MedicalRecordWithRelations>> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    const parsed = medicalRecordSchema.safeParse(data);\n    if (!parsed.success) {\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors: parsed.error.flatten().fieldErrors,\n        data: null,\n      };\n    }\n\n    const record = await prisma.medicalRecord.create({\n      data: {\n        dogId: parsed.data.dogId,\n        date: parsed.data.date,\n        type: parsed.data.type,\n        notes: parsed.data.notes,\n        vaccination: parsed.data.type === MedicalRecordType.VACCINATION ? {\n          create: {\n            vaccineType: parsed.data.vaccineType,\n            nextDueDate: parsed.data.nextDueDate,\n          }\n        } : undefined,\n        medication: parsed.data.type === MedicalRecordType.MEDICATION ? {\n          create: {\n            medicationName: parsed.data.medicationName,\n            dosage: parsed.data.dosage,\n            frequency: parsed.data.frequency,\n          }\n        } : undefined,\n        vetVisit: parsed.data.type === MedicalRecordType.VET_VISIT ? {\n          create: {\n            vetName: parsed.data.vetName,\n            visitReason: parsed.data.visitReason,\n          }\n        } : undefined,\n      },\n      include: {\n        vaccination: true,\n        medication: true,\n        vetVisit: true,\n      },\n    });\n\n    revalidatePath(`/admin/edit-dog/${parsed.data.dogId}`);\n\n    return {\n      success: true,\n      message: \"Medical record created successfully!\",\n      fieldErrors: undefined,\n      data: record,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to create medical record\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function updateMedicalRecord(recordId: number, data: MedicalRecordFormData): Promise<ActionResult<MedicalRecordWithRelations>> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    const parsed = medicalRecordSchema.safeParse(data);\n    if (!parsed.success) {\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors: parsed.error.flatten().fieldErrors,\n        data: null,\n      };\n    }\n\n    const record = await prisma.medicalRecord.update({\n      where: { id: recordId },\n      data: {\n        dogId: parsed.data.dogId,\n        date: parsed.data.date,\n        type: parsed.data.type,\n        notes: parsed.data.notes,\n        vaccination: parsed.data.type === MedicalRecordType.VACCINATION ? {\n          upsert: {\n            create: {\n              vaccineType: parsed.data.vaccineType,\n              nextDueDate: parsed.data.nextDueDate,\n            },\n            update: {\n              vaccineType: parsed.data.vaccineType,\n              nextDueDate: parsed.data.nextDueDate,\n            }\n          }\n        } : { delete: true },\n        medication: parsed.data.type === MedicalRecordType.MEDICATION ? {\n          upsert: {\n            create: {\n              medicationName: parsed.data.medicationName,\n              dosage: parsed.data.dosage,\n              frequency: parsed.data.frequency,\n            },\n            update: {\n              medicationName: parsed.data.medicationName,\n              dosage: parsed.data.dosage,\n              frequency: parsed.data.frequency,\n            }\n          }\n        } : { delete: true },\n        vetVisit: parsed.data.type === MedicalRecordType.VET_VISIT ? {\n          upsert: {\n            create: {\n              vetName: parsed.data.vetName,\n              visitReason: parsed.data.visitReason,\n            },\n            update: {\n              vetName: parsed.data.vetName,\n              visitReason: parsed.data.visitReason,\n            }\n          }\n        } : { delete: true },\n      },\n      include: {\n        vaccination: true,\n        medication: true,\n        vetVisit: true,\n      },\n    });\n\n    revalidatePath(`/admin/edit-dog/${parsed.data.dogId}`);\n\n    return {\n      success: true,\n      message: \"Medical record updated successfully!\",\n      fieldErrors: undefined,\n      data: record,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to update medical record\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function deleteMedicalRecord(recordId: number, dogId: number): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    const parsed = deleteRecordSchema.safeParse({ recordId, dogId });\n    if (!parsed.success) {\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors: parsed.error.flatten().fieldErrors,\n        data: null,\n      };\n    }\n\n    await prisma.medicalRecord.delete({\n      where: { id: parsed.data.recordId },\n    });\n    revalidatePath(`/admin/edit-dog/${parsed.data.dogId}`);\n\n    return {\n      success: true,\n      message: \"Medical record deleted successfully!\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to delete medical record\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function getMedicalRecords(dogId: number, page = 1, pageSize = 10) {\n  await assertRole(UserRole.STAFF);\n\n  const parsed = z.object({\n    dogId: z.coerce.number().int().positive(),\n    page: z.coerce.number().int().min(1),\n    pageSize: z.coerce.number().int().min(1).max(100)\n  }).safeParse({ dogId, page, pageSize });\n\n  if (!parsed.success) {\n    throw new Error(\"Invalid parameters\");\n  }\n\n  const skip = (page - 1) * pageSize;\n\n  const [records, totalCount] = await Promise.all([\n    prisma.medicalRecord.findMany({\n      where: { dogId },\n      include: {\n        vaccination: true,\n        medication: true,\n        vetVisit: true\n      },\n      orderBy: { date: 'desc' },\n      skip,\n      take: pageSize,\n    }),\n    prisma.medicalRecord.count({\n      where: { dogId },\n    }),\n  ]);\n\n  return {\n    records,\n    totalCount,\n    page,\n    pageSize,\n    totalPages: Math.ceil(totalCount / pageSize),\n  };\n}\n\nexport async function uploadMedicalDocument(\n  _prevState: ActionResult | undefined,\n  formData: FormData,\n): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    // Parse dogId from formData\n    const parsed = uploadDocSchema.safeParse({\n      dogId: formData.get(\"dogId\")\n    });\n    if (!parsed.success) {\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors: parsed.error.flatten().fieldErrors,\n        data: null,\n      };\n    }\n\n    const { dogId } = parsed.data;\n    const file = formData.get(\"file\") as File;\n\n    if (!file) {\n      return {\n        success: false,\n        message: \"No file provided\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    // Validate file extension\n    const extension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));\n    if (!ALLOWED_EXTENSIONS.includes(extension)) {\n      return {\n        success: false,\n        message: `File type not allowed. Allowed types: ${ALLOWED_EXTENSIONS.join(', ')}`,\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    // Validate content type\n    if (!ALLOWED_CONTENT_TYPES.includes(file.type)) {\n      return {\n        success: false,\n        message: `File type \"${file.type}\" not allowed. Allowed types: PDF and images only.`,\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    // Validate file size\n    if (file.size > MAX_FILE_SIZE) {\n      return {\n        success: false,\n        message: `File too large. Maximum size: ${MAX_FILE_SIZE / (1024 * 1024)}MB`,\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    // Get current user for audit logging\n    const user = await getActingUser();\n    if (!user) {\n      return {\n        success: false,\n        message: \"Authentication required\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    const supabase = await createClient();\n\n    // Generate unique storage path\n    const timestamp = Date.now();\n    const randomId = Math.random().toString(36).substring(2, 15);\n    const storagePath = `medical-documents/${dogId}/${timestamp}-${randomId}-${file.name}`;\n\n    try {\n      // Convert File to ArrayBuffer for upload\n      const arrayBuffer = await file.arrayBuffer();\n      const fileBuffer = new Uint8Array(arrayBuffer);\n\n      // Upload file to Supabase Storage\n      const { error: uploadError } = await supabase.storage\n        .from(\"medical-documents\")\n        .upload(storagePath, fileBuffer, {\n          contentType: file.type,\n          upsert: false,\n        });\n\n      if (uploadError) {\n        return {\n          success: false,\n          message: `Failed to upload file: ${uploadError.message}`,\n          fieldErrors: undefined,\n          data: null,\n        };\n      }\n\n      // Store document record in database\n      const document = await prisma.medicalDocument.create({\n        data: {\n          dogId,\n          name: file.name,\n          path: storagePath,\n          mime: file.type,\n          size: file.size,\n          uploadedByUserId: user.id,\n        },\n      });\n\n      // Log audit event (skip in tests where auth might not be set up)\n      if (process.env.NODE_ENV !== 'test') {\n        try {\n          const userId = await getCurrentUserId();\n          await prisma.auditLog.create({\n            data: {\n              action: AuditAction.MEDICAL_DOCUMENT_UPLOAD,\n              actorId: userId,\n              entityType: \"medicalDocument\",\n              entityId: document.id,\n              note: `Uploaded medical document: ${file.name} for dog ${dogId}`,\n            }\n          });\n        } catch (auditError) {\n          // Don't fail the upload if audit logging fails\n          console.warn(\"Failed to log medical document upload audit event:\", auditError);\n        }\n      }\n\n      revalidatePath(`/admin/dog/${dogId}?tab=medical`);\n\n      return {\n        success: true,\n        message: \"Medical document uploaded successfully!\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    } catch (error) {\n      // Attempt to clean up the uploaded file if database insert fails\n      await supabase.storage\n        .from(\"medical-documents\")\n        .remove([storagePath])\n        .catch(() => {\n          // Best-effort cleanup\n        });\n\n      return {\n        success: false,\n        message: error instanceof Error ? error.message : \"Failed to upload medical document\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to upload medical document\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function getMedicalDocuments(dogId: number): Promise<MedicalDocumentSummary[]> {\n  await assertRole(UserRole.STAFF);\n\n  const parsed = getDocumentsSchema.safeParse({ dogId });\n  if (!parsed.success) {\n    throw new Error(\"Invalid dog ID\");\n  }\n\n  const supabase = await createClient();\n  const documents = await prisma.medicalDocument.findMany({\n    where: { dogId },\n    orderBy: {\n      createdAt: \"desc\", // Note: test expects 'uploadedAt' but field is 'createdAt'\n    },\n  });\n\n  // Generate signed URLs for each document\n  const documentsWithSignedUrls: MedicalDocumentSummary[] = await Promise.all(\n    documents.map(async (doc) => {\n      const { data: signedUrlData } = await supabase.storage\n        .from(\"medical-documents\")\n        .createSignedUrl(doc.path, 900); // 15 minutes expiry\n\n      return {\n        ...doc,\n        signedUrl: signedUrlData?.signedUrl || null,\n      };\n    })\n  );\n\n  return documentsWithSignedUrls;\n}\n\nexport async function deleteMedicalDocument(documentId: number, storagePath: string): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    const parsed = deleteDocSchema.safeParse({ documentId, storagePath });\n    if (!parsed.success) {\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors: parsed.error.flatten().fieldErrors,\n        data: null,\n      };\n    }\n\n    // Get document info before deletion for audit logging\n    const document = await prisma.medicalDocument.findUnique({\n      where: { id: documentId },\n      select: { dogId: true, name: true }\n    });\n\n    if (!document) {\n      return {\n        success: false,\n        message: \"Document not found\",\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    const supabase = await createClient();\n    const { error: deleteError } = await supabase.storage\n      .from(\"medical-documents\")\n      .remove([storagePath]);\n\n    if (deleteError) {\n      return {\n        success: false,\n        message: `Failed to delete document from storage: ${deleteError.message}`,\n        fieldErrors: undefined,\n        data: null,\n      };\n    }\n\n    await prisma.medicalDocument.delete({\n      where: { id: documentId },\n    });\n\n    // Log audit event (skip in tests where auth might not be set up)\n    if (process.env.NODE_ENV !== 'test') {\n      try {\n        const userId = await getCurrentUserId();\n        await prisma.auditLog.create({\n          data: {\n            action: AuditAction.MEDICAL_DOCUMENT_DELETE,\n          actorId: userId,\n          entityType: \"medicalDocument\",\n          entityId: documentId,\n          note: `Deleted medical document: ${document.name} for dog ${document.dogId}`,\n        }\n        });\n      } catch (auditError) {\n        // Don't fail the deletion if audit logging fails\n        console.warn(\"Failed to log medical document deletion audit event:\", auditError);\n      }\n    }\n\n    revalidatePath(`/admin/dog/${document.dogId}?tab=medical`);\n\n    return {\n      success: true,\n      message: \"Medical document deleted successfully!\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"Failed to delete medical document\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1616, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/dog-filters.ts"],"sourcesContent":["/**\n * Dog filters DTO and URL helpers for consistent filtering across dog-related components\n */\n\nimport { DogSize, Gender, DogStatus } from \"@prisma/client\";\n\n/**\n * Canonical parameter names for dog filter URL search parameters\n */\nexport const DOG_FILTER_PARAMS = {\n  BREED: \"breed\",\n  AGE_MIN: \"ageMin\",\n  AGE_MAX: \"ageMax\",\n  SPECIAL_NEEDS: \"specialNeeds\",\n  SIZE: \"size\",\n  GENDER: \"gender\",\n  HAS_PHOTOS: \"hasPhotos\",\n} as const;\n\n/**\n * Canonical parameter names for admin dog filter URL search parameters\n */\nexport const ADMIN_DOG_FILTER_PARAMS = {\n  STATUS: \"status\",\n  FOSTER_PROFILE_ID: \"fosterProfileId\",\n  BREED: \"breed\",\n  GENDER: \"gender\",\n  SIZE: \"size\",\n  WEIGHT_MIN: \"weightMin\",\n  WEIGHT_MAX: \"weightMax\",\n  SPECIAL_NEEDS: \"specialNeeds\",\n  HAS_PHOTOS: \"hasPhotos\",\n} as const;\n\n/**\n * Magic values for foster filtering (kept at edge layers)\n */\nexport const FOSTER_FILTER_VALUES = {\n  ALL: \"all\",\n  NONE: \"none\", // URL layer sentinel for \"no foster assigned\"\n  NO_FOSTER_FORM: \"\", // Form layer sentinel for \"no foster assigned\" (empty string)\n} as const;\n\n/**\n * Dog filters DTO - data transfer object for dog filtering (adopt page)\n */\nexport type DogFilters = {\n  breed?: string;\n  gender?: Gender;\n  size?: DogSize;\n  specialNeeds?: \"true\";\n  hasPhotos?: \"true\";\n};\n\n/**\n * Admin dog filters DTO - data transfer object for admin dog filtering\n */\nexport type AdminDogFilters = {\n  status?: DogStatus | \"all\";\n  fosterProfileId?: string;\n  breed?: string;\n  gender?: Gender | \"all\";\n  size?: DogSize | \"all\";\n  weightMin?: string;\n  weightMax?: string;\n  specialNeeds?: \"all\" | \"true\" | \"false\";\n  hasPhotos?: \"all\" | \"true\" | \"false\";\n};\n\n/**\n * Type guard to check if a foster filter value means \"no foster assigned\"\n */\nexport function isNoFosterFilter(value: string): boolean {\n  return value === FOSTER_FILTER_VALUES.NONE;\n}\n\n/**\n * Parse a foster filter value into a typed union or enum.\n * Returns the profile ID string if it's a specific foster, null if \"no foster\", or undefined if \"all\".\n */\nexport function parseFosterFilterValue(value: string): string | null | undefined {\n  if (value === FOSTER_FILTER_VALUES.ALL) return undefined;\n  if (value === FOSTER_FILTER_VALUES.NONE) return null;\n  return value; // Specific foster profile ID\n}\n\n/**\n * Parse dog filters from URL search parameters\n */\nexport function parseDogFilters(searchParams: URLSearchParams): DogFilters {\n  return {\n    breed: searchParams.get(DOG_FILTER_PARAMS.BREED) || undefined,\n    specialNeeds: searchParams.get(DOG_FILTER_PARAMS.SPECIAL_NEEDS) === \"true\" ? \"true\" : undefined,\n    size: searchParams.get(DOG_FILTER_PARAMS.SIZE) as DogSize || undefined,\n    gender: searchParams.get(DOG_FILTER_PARAMS.GENDER) as Gender || undefined,\n    hasPhotos: searchParams.get(DOG_FILTER_PARAMS.HAS_PHOTOS) === \"true\" ? \"true\" : undefined,\n  };\n}\n\n/**\n * Serialize dog filters to URL search parameters\n */\nexport function serializeDogFilters(filters: DogFilters): URLSearchParams {\n  const params = new URLSearchParams();\n\n  if (filters.breed) params.set(DOG_FILTER_PARAMS.BREED, filters.breed);\n  if (filters.specialNeeds) params.set(DOG_FILTER_PARAMS.SPECIAL_NEEDS, \"true\");\n  if (filters.size) params.set(DOG_FILTER_PARAMS.SIZE, filters.size);\n  if (filters.gender) params.set(DOG_FILTER_PARAMS.GENDER, filters.gender);\n  if (filters.hasPhotos) params.set(DOG_FILTER_PARAMS.HAS_PHOTOS, \"true\");\n\n  return params;\n}\n\n/**\n * Encode dog filters to URL search string\n */\nexport function encodeDogFilters(filters: DogFilters): string {\n  return serializeDogFilters(filters).toString();\n}\n\n/**\n * Check if any filters are active\n */\nexport function hasActiveFilters(filters: DogFilters): boolean {\n  return !!(\n    filters.breed ||\n    filters.specialNeeds ||\n    filters.size ||\n    filters.gender ||\n    filters.hasPhotos\n  );\n}\n\n/**\n * Create empty dog filters\n */\nexport function createEmptyDogFilters(): DogFilters {\n  return {};\n}\n\n/**\n * Get dog filters from URL search parameters with Next.js router\n */\nexport function getDogFiltersFromSearchParams(searchParams: URLSearchParams): DogFilters {\n  return parseDogFilters(searchParams);\n}\n\n/**\n * Update dog filters in URL using Next.js router\n */\nexport function updateDogFiltersInUrl(\n  router: { push: (url: string) => void }, // Next.js App Router useRouter\n  pathname: string,\n  currentFilters: DogFilters,\n  patch: Partial<DogFilters>\n): void {\n  const newFilters = { ...currentFilters, ...patch };\n  const params = serializeDogFilters(newFilters);\n  router.push(`${pathname}?${params.toString()}`);\n}\n\n/**\n * Parse admin dog filters from URL search parameters\n */\nexport function parseAdminDogFilters(searchParams: URLSearchParams): AdminDogFilters {\n  return {\n    status: searchParams.get(ADMIN_DOG_FILTER_PARAMS.STATUS) as DogStatus || \"all\",\n    fosterProfileId: searchParams.get(ADMIN_DOG_FILTER_PARAMS.FOSTER_PROFILE_ID) || \"all\",\n    breed: searchParams.get(ADMIN_DOG_FILTER_PARAMS.BREED) || \"all\",\n    gender: searchParams.get(ADMIN_DOG_FILTER_PARAMS.GENDER) as Gender || \"all\",\n    size: searchParams.get(ADMIN_DOG_FILTER_PARAMS.SIZE) as DogSize || \"all\",\n    weightMin: searchParams.get(ADMIN_DOG_FILTER_PARAMS.WEIGHT_MIN) || \"\",\n    weightMax: searchParams.get(ADMIN_DOG_FILTER_PARAMS.WEIGHT_MAX) || \"\",\n    specialNeeds: searchParams.get(ADMIN_DOG_FILTER_PARAMS.SPECIAL_NEEDS) as \"all\" | \"true\" | \"false\" || \"all\",\n    hasPhotos: searchParams.get(ADMIN_DOG_FILTER_PARAMS.HAS_PHOTOS) as \"all\" | \"true\" | \"false\" || \"all\",\n  };\n}\n\n/**\n * Serialize admin dog filters to URL search parameters\n */\nexport function serializeAdminDogFilters(filters: AdminDogFilters): URLSearchParams {\n  const params = new URLSearchParams();\n\n  if (filters.status && filters.status !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.STATUS, filters.status);\n  if (filters.fosterProfileId && filters.fosterProfileId !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.FOSTER_PROFILE_ID, filters.fosterProfileId);\n  if (filters.breed && filters.breed !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.BREED, filters.breed);\n  if (filters.gender && filters.gender !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.GENDER, filters.gender);\n  if (filters.size && filters.size !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.SIZE, filters.size);\n  if (filters.weightMin && filters.weightMin !== \"\") params.set(ADMIN_DOG_FILTER_PARAMS.WEIGHT_MIN, filters.weightMin);\n  if (filters.weightMax && filters.weightMax !== \"\") params.set(ADMIN_DOG_FILTER_PARAMS.WEIGHT_MAX, filters.weightMax);\n  if (filters.specialNeeds && filters.specialNeeds !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.SPECIAL_NEEDS, filters.specialNeeds);\n  if (filters.hasPhotos && filters.hasPhotos !== \"all\") params.set(ADMIN_DOG_FILTER_PARAMS.HAS_PHOTOS, filters.hasPhotos);\n\n  return params;\n}\n\n/**\n * Encode admin dog filters to URL search string\n */\nexport function encodeAdminDogFilters(filters: AdminDogFilters): string {\n  return serializeAdminDogFilters(filters).toString();\n}\n\n/**\n * Check if any admin dog filters are active\n */\nexport function hasActiveAdminDogFilters(filters: AdminDogFilters): boolean {\n  return !!(\n    (filters.status && filters.status !== \"all\") ||\n    (filters.fosterProfileId && filters.fosterProfileId !== \"all\") ||\n    (filters.breed && filters.breed !== \"all\") ||\n    (filters.gender && filters.gender !== \"all\") ||\n    (filters.size && filters.size !== \"all\") ||\n    (filters.weightMin && filters.weightMin !== \"\") ||\n    (filters.weightMax && filters.weightMax !== \"\") ||\n    (filters.specialNeeds && filters.specialNeeds !== \"all\") ||\n    (filters.hasPhotos && filters.hasPhotos !== \"all\")\n  );\n}\n\n/**\n * Create empty admin dog filters\n */\nexport function createEmptyAdminDogFilters(): AdminDogFilters {\n  return {\n    status: \"all\",\n    fosterProfileId: \"all\",\n    breed: \"all\",\n    gender: \"all\",\n    size: \"all\",\n    weightMin: \"\",\n    weightMax: \"\",\n    specialNeeds: \"all\",\n    hasPhotos: \"all\",\n  };\n}\n\n/**\n * Get admin dog filters from URL search parameters with Next.js router\n */\nexport function getAdminDogFiltersFromSearchParams(searchParams: URLSearchParams): AdminDogFilters {\n  return parseAdminDogFilters(searchParams);\n}\n\n/**\n * Update admin dog filters in URL using Next.js router\n */\nexport function updateAdminDogFiltersInUrl(\n  router: { push: (url: string) => void }, // Next.js App Router useRouter\n  pathname: string,\n  currentFilters: AdminDogFilters,\n  patch: Partial<AdminDogFilters>\n): void {\n  const newFilters = { ...currentFilters, ...patch };\n  const params = serializeAdminDogFilters(newFilters);\n  // Reset to page 1 when filtering\n  params.set(\"page\", \"1\");\n  router.push(`${pathname}?${params.toString()}`);\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1791, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/lib/actions/dog.actions.ts"],"sourcesContent":["// lib/actions/dog.actions.ts\n\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\nimport { prisma } from \"@/lib/prisma\";\nimport { Dog, DogStatus, Gender, DogSize, Prisma, AuditAction } from \"@prisma/client\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { assertRole } from \"@/lib/actions/profile.actions\";\nimport { UserRole } from \"@prisma/client\";\nimport { ActionResult } from \"@/lib/types\";\nimport { calculateAge } from \"@/lib/utils/dog-utils\";\nimport { dogFormSchema } from \"@/lib/schemas\";\nimport { z } from \"zod\";\nimport { withAudit, getCurrentUserId, captureAuditState } from \"./audit.actions\";\nimport { getMedicalRecords, getMedicalDocuments } from \"./medical.actions\";\nimport { FOSTER_FILTER_VALUES } from \"@/lib/dog-filters\";\n\nconst deleteDogSchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n  reason: z.string().min(10, { message: \"Reason must be at least 10 characters long\" }).max(1000, { message: \"Reason must be less than 1000 characters\" }),\n});\n\nconst uploadImageSchema = z.object({\n  dogId: z.coerce.number().int().positive({ message: \"Invalid dog ID\" }),\n  // File validation will be handled separately after dogId validation\n});\n\nconst getAllDogsSchema = z.object({\n  page: z.coerce.number().int().min(1).optional().default(1),\n  limit: z.coerce.number().int().min(1).max(100).optional().default(10),\n  status: z.enum([\"all\", ...Object.values(DogStatus)]).optional().default(\"all\"),\n  fosterProfileId: z.enum([FOSTER_FILTER_VALUES.ALL, FOSTER_FILTER_VALUES.NONE]).or(z.string()).optional().default(FOSTER_FILTER_VALUES.ALL), // Profile ID (string) or \"none\"\n  breed: z.string().optional().default(\"all\"),\n  gender: z.enum([\"all\", ...Object.values(Gender)]).optional().default(\"all\"),\n  size: z.enum([\"all\", ...Object.values(DogSize)]).optional().default(\"all\"),\n  weightMin: z.string().regex(/^\\d*$/, { message: \"Weight must be a number\" }).optional(),\n  weightMax: z.string().regex(/^\\d*$/, { message: \"Weight must be a number\" }).optional(),\n  specialNeeds: z.string().optional().default(\"all\"),\n  hasPhotos: z.string().optional().default(\"all\"),\n  sortField: z.enum([\"name\", \"status\", \"breed\"]).optional().default(\"name\"),\n  sortDirection: z.enum([\"asc\", \"desc\"]).optional().default(\"asc\"),\n});\n\n// Shared photo upload function\nasync function uploadDogPhoto(file: File): Promise<string> {\n  const supabase = await createClient();\n  const timestamp = Date.now();\n  const sanitizedFileName = file.name.replace(/\\s+/g, \"-\");\n  const storagePath = `dog-${timestamp}-${sanitizedFileName}`;\n\n  const { error: uploadError } = await supabase.storage\n    .from(\"dog-photos\")\n    .upload(storagePath, file, {\n      upsert: false,\n    });\n\n  if (uploadError) {\n    throw new Error(`Storage Error: ${uploadError.message}`);\n  }\n\n  const { data: urlData } = supabase.storage\n    .from(\"dog-photos\")\n    .getPublicUrl(storagePath);\n\n  const publicUrl = urlData.publicUrl;\n  if (!publicUrl) {\n    throw new Error(\"Unable to generate public URL for uploaded photo\");\n  }\n\n  return publicUrl;\n}\n\nexport async function createDog(formData: FormData): Promise<ActionResult<Dog> | never> {\n  try {\n    await assertRole(UserRole.STAFF);\n\n    const parsed = dogFormSchema.safeParse(Object.fromEntries(formData.entries()));\n    if (!parsed.success) {\n      const fieldErrors = parsed.error.flatten().fieldErrors;\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors,\n        data: null,\n      };\n    }\n\n    const {\n      name,\n      status,\n      breed,\n      dateOfBirth,\n      bioPublic,\n      notesInternal,\n      fosterProfileId,\n      specialNeeds,\n    } = parsed.data;\n\n    const finalStatus = status ?? DogStatus.INTAKE;\n\n    // Handle primary photo upload if provided\n    let primaryPhotoUrl = \"https://picsum.photos/300/200?random=1\"; // Default placeholder\n    const file = formData.get(\"file\");\n\n    if (file instanceof File && file.size > 0) {\n      try {\n        primaryPhotoUrl = await uploadDogPhoto(file);\n      } catch (error) {\n        // For now, we'll continue with the default placeholder if upload fails\n        // In production, you might want to return an error instead\n        console.error(\"Failed to upload dog photo:\", error);\n      }\n    }\n\n    await prisma.dog.create({\n      data: {\n        name,\n        status: finalStatus,\n        breed,\n        dateOfBirth,\n        bioPublic,\n        notesInternal,\n        specialNeeds,\n        fosterProfileId: finalStatus === DogStatus.IN_FOSTER ? fosterProfileId : null,\n        primaryPhotoUrl,\n      },\n    });\n\n    revalidatePath(\"/admin/dogs\");\n    revalidatePath(\"/adopt\");\n    redirect(\"/admin/dogs\");\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"An unexpected error occurred.\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function updateDog(dogId: number, formData: FormData): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.STAFF);\n    const userId = await getCurrentUserId();\n\n    const file = formData.get('file') as File | null;\n    let newPhotoUrl: string | undefined = undefined;\n\n    if (file && file.size > 0) {\n      try {\n        newPhotoUrl = await uploadDogPhoto(file);\n      } catch (error) {\n        return {\n          success: false,\n          message: error instanceof Error ? error.message : \"Failed to upload photo\",\n          fieldErrors: undefined,\n          data: null,\n        };\n      }\n    }\n\n    const parsed = dogFormSchema.safeParse(Object.fromEntries(formData.entries()));\n    if (!parsed.success) {\n      const fieldErrors = parsed.error.flatten().fieldErrors;\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors,\n        data: null,\n      };\n    }\n\n    const {\n      name,\n      status,\n      breed,\n      dateOfBirth,\n      bioPublic,\n      notesInternal,\n      fosterProfileId,\n      specialNeeds,\n    } = parsed.data;\n\n    const finalStatus = status ?? DogStatus.INTAKE;\n\n    // Capture before state for audit\n    const beforeState = await captureAuditState('dog', dogId);\n\n    const updateData: {\n      name: string;\n      status: DogStatus;\n      breed: string | null;\n      dateOfBirth: Date | null;\n      bioPublic: string | null;\n      notesInternal: string | null;\n      specialNeeds: boolean;\n      fosterProfileId: string | null;\n      primaryPhotoUrl?: string;\n    } = {\n      name,\n      status: finalStatus,\n      breed,\n      dateOfBirth,\n      bioPublic,\n      notesInternal,\n      specialNeeds,\n      fosterProfileId: finalStatus === DogStatus.IN_FOSTER ? fosterProfileId : null,\n    };\n\n    if (newPhotoUrl) {\n      updateData.primaryPhotoUrl = newPhotoUrl;\n    }\n\n    await withAudit(\n      \"updateDog\",\n      userId,\n      async () => {\n        const updatedDog = await prisma.dog.update({\n          where: { id: dogId },\n          data: updateData,\n        });\n\n        revalidatePath(\"/admin\");\n        revalidatePath(`/admin/edit-dog/${dogId}`);\n        revalidatePath(\"/adopt\");\n        revalidatePath(`/adopt/${dogId}`);\n\n        return updatedDog;\n      },\n      {\n        action: AuditAction.DOG_EDIT,\n        entityType: 'dog',\n        entityId: dogId,\n        before: beforeState || undefined,\n        after: beforeState ? { ...beforeState, ...updateData } : undefined,\n        note: `Updated dog: ${name}`,\n      }\n    );\n\n    return {\n      success: true,\n      message: \"Dog updated successfully!\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"An unexpected error occurred.\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function uploadAndSetDogImage(prevState: { message: string | null; newImageUrl: string | null }, formData: FormData) {\n  try {\n    await assertRole(UserRole.STAFF);\n  } catch (error) {\n    return { message: error instanceof Error ? error.message : \"Not authorized\", newImageUrl: null };\n  }\n\n  const parsed = uploadImageSchema.safeParse(Object.fromEntries(formData.entries()));\n  if (!parsed.success) {\n    return { message: parsed.error.issues.map(issue => `${issue.path.join('.')}: ${issue.message}`).join(', '), newImageUrl: null };\n  }\n\n  const { dogId } = parsed.data;\n  const file = formData.get(\"file\") as File;\n  if (!file || file.size === 0) {\n    return { message: \"No file provided.\", newImageUrl: null };\n  }\n\n  const supabase = await createClient();\n  const filePath = `dogs/${dogId}-${file.name}-${Date.now()}`;\n\n  try {\n    const { error: uploadError } = await supabase.storage\n      .from(\"images\") // BUCKET NAME - YOU MUST CREATE THIS IN SUPABASE\n      .upload(filePath, file);\n\n    if (uploadError) {\n      throw new Error(`Storage Error: ${uploadError.message}`);\n    }\n\n    const { data: { publicUrl } } = supabase.storage\n      .from(\"images\")\n      .getPublicUrl(filePath);\n\n    if (!publicUrl) {\n      throw new Error(\"Could not get public URL.\");\n    }\n\n    await prisma.dog.update({\n      where: { id: dogId },\n      data: { primaryPhotoUrl: publicUrl },\n    });\n\n    revalidatePath(\"/admin\");\n    revalidatePath(`/admin/edit-dog/${dogId}`);\n    revalidatePath(\"/adopt\");\n    revalidatePath(`/adopt/${dogId}`);\n\n    return { message: null, newImageUrl: publicUrl };\n\n  } catch (error) {\n    console.error(\"Upload failed:\", error);\n    return { message: error instanceof Error ? error.message : \"Upload failed.\", newImageUrl: null };\n  }\n}\n\nexport async function deleteDog(dogId: number, reason: string): Promise<ActionResult> {\n  try {\n    await assertRole(UserRole.STAFF);\n    const userId = await getCurrentUserId();\n\n    const parsed = deleteDogSchema.safeParse({ dogId, reason });\n    if (!parsed.success) {\n      const fieldErrors = parsed.error.flatten().fieldErrors;\n      return {\n        success: false,\n        message: \"Validation failed.\",\n        fieldErrors,\n        data: null,\n      };\n    }\n\n    // Capture before state for audit\n    const beforeState = await captureAuditState('dog', parsed.data.dogId);\n\n    await withAudit(\n      \"deleteDog\",\n      userId,\n      async () => {\n        await prisma.dog.delete({ where: { id: parsed.data.dogId } });\n        revalidatePath(\"/admin/dogs\");\n        revalidatePath(\"/adopt\");\n        return null;\n      },\n      {\n        action: AuditAction.DOG_EDIT,\n        entityType: 'dog',\n        entityId: parsed.data.dogId,\n        before: beforeState || undefined,\n        after: undefined,\n        note: `Deleted dog. Reason: ${parsed.data.reason}`,\n      }\n    );\n\n    return {\n      success: true,\n      message: \"Dog deleted successfully! Redirecting...\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : \"An unexpected error occurred.\",\n      fieldErrors: undefined,\n      data: null,\n    };\n  }\n}\n\nexport async function getDogById(id: number) {\n  const parsed = z.object({ id: z.coerce.number().int().positive() }).safeParse({ id });\n  if (!parsed.success) {\n    throw new Error(\"Invalid dog ID\");\n  }\n\n  const dog = await prisma.dog.findUnique({\n    where: { id },\n    include: {\n      fosterProfile: {\n        select: {\n          profileId: true,\n          profile: {\n            select: {\n              name: true,\n              email: true,\n            },\n          },\n        },\n      },\n    },\n  });\n\n  if (!dog) {\n    throw new Error(\"Dog not found\");\n  }\n\n  // Compute derived values on the fly\n  const isSenior = calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false;\n  const hasPhotos = dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false;\n\n  return {\n    ...dog,\n    isSenior, // Runtime property\n    hasPhotos, // Runtime property\n  };\n}\n\nexport async function getAllDogs(searchParams?: { [key: string]: string | undefined }) {\n  await assertRole(UserRole.STAFF);\n\n  const parsed = getAllDogsSchema.safeParse(searchParams || {});\n  if (!parsed.success) {\n    throw new Error(\"Invalid search parameters\");\n  }\n\n  const { page, limit } = parsed.data;\n  const offset = (page - 1) * limit;\n\n  // Build where clause for filtering\n  const where: Prisma.DogWhereInput = {};\n\n  if (parsed.data.status && parsed.data.status !== \"all\") {\n    where.status = parsed.data.status;\n  }\n\n  if (parsed.data.fosterProfileId && parsed.data.fosterProfileId !== FOSTER_FILTER_VALUES.ALL) {\n    if (parsed.data.fosterProfileId === FOSTER_FILTER_VALUES.NONE) {\n      // Filter for dogs with no foster assigned\n      where.fosterProfileId = null;\n    } else {\n      // Filter for specific foster\n      where.fosterProfileId = parsed.data.fosterProfileId;\n    }\n  }\n\n  if (parsed.data.breed && parsed.data.breed !== \"all\" && parsed.data.breed !== \"\") {\n    where.breed = {\n      contains: parsed.data.breed,\n      mode: 'insensitive' as const,\n    };\n  }\n\n  if (parsed.data.gender && parsed.data.gender !== \"all\") {\n    where.gender = parsed.data.gender;\n  }\n\n  if (parsed.data.size && parsed.data.size !== \"all\") {\n    where.size = parsed.data.size;\n  }\n\n  if (parsed.data.weightMin && parsed.data.weightMin !== \"\") {\n    const weightMin = parseInt(parsed.data.weightMin, 10);\n    if (!Number.isNaN(weightMin)) {\n      where.weight_lbs = { gte: weightMin };\n    }\n  }\n\n  if (parsed.data.weightMax && parsed.data.weightMax !== \"\") {\n    const weightMax = parseInt(parsed.data.weightMax, 10);\n    if (!Number.isNaN(weightMax)) {\n      where.weight_lbs = where.weight_lbs ? { ...(where.weight_lbs as object), lte: weightMax } : { lte: weightMax };\n    }\n  }\n\n\n  if (parsed.data.specialNeeds && parsed.data.specialNeeds !== \"all\") {\n    where.specialNeeds = parsed.data.specialNeeds === \"true\";\n  }\n\n  if (parsed.data.hasPhotos && parsed.data.hasPhotos !== \"all\") {\n    if (parsed.data.hasPhotos === \"true\") {\n      where.primaryPhotoUrl = { not: null };\n    } else {\n      where.primaryPhotoUrl = null;\n    }\n  }\n\n  // Build orderBy clause for sorting\n  const orderBy: Prisma.DogOrderByWithRelationInput = {};\n  const sortField = parsed.data.sortField;\n  const sortDirection = parsed.data.sortDirection;\n\n  switch (sortField) {\n    case \"name\":\n      orderBy.name = sortDirection;\n      break;\n    case \"status\":\n      orderBy.status = sortDirection;\n      break;\n    case \"breed\":\n      orderBy.breed = sortDirection;\n      break;\n    default:\n      orderBy.name = \"asc\";\n  }\n\n  const [dogs, totalCount] = await Promise.all([\n    prisma.dog.findMany({\n      where,\n      orderBy,\n      skip: offset,\n      take: limit,\n      select: {\n        id: true,\n        mutt_id: true,\n        name: true,\n        breed: true,\n        dateOfBirth: true,\n        status: true,\n        primaryPhotoUrl: true,\n        gender: true,\n        weight_lbs: true,\n        size: true,\n        specialNeeds: true,\n        bioPublic: true,\n        createdAt: true,\n        fosterProfile: {\n          select: {\n            profile: {\n              select: {\n                name: true,\n                email: true,\n              },\n            },\n          },\n        },\n      },\n    }),\n    prisma.dog.count({ where }),\n  ]);\n\n  const totalPages = Math.ceil(totalCount / limit);\n\n  // Flatten foster profile data and compute derived fields\n  const dogsWithFlattenedFoster = dogs.map(dog => ({\n    ...dog,\n    fosterProfile: dog.fosterProfile ? {\n      ...dog.fosterProfile,\n      name: dog.fosterProfile.profile?.name,\n      email: dog.fosterProfile.profile?.email,\n    } : null,\n    // Compute derived values on the fly\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n\n  return {\n    dogs: dogsWithFlattenedFoster,\n    pagination: {\n      currentPage: page,\n      totalPages,\n      totalCount,\n      hasNextPage: page < totalPages,\n      hasPreviousPage: page > 1,\n    },\n  };\n}\n\nexport type DogFilters = {\n  breed?: string;\n  specialNeeds?: string;\n  size?: string;\n  gender?: string;\n  hasPhotos?: string;\n};\n\nconst coerceBoolean = (value?: string) => {\n  if (value === undefined) return undefined;\n  if (value === \"true\") return true;\n  if (value === \"false\") return false;\n  return undefined;\n};\n\nexport async function getDogs({ page = 1, pageSize = 12 }: { page?: number; pageSize?: number } = {}) {\n  const take = pageSize;\n  const skip = (Math.max(1, page) - 1) * take;\n\n  const where: Prisma.DogWhereInput = {\n    status: DogStatus.AVAILABLE,\n  };\n\n  const [dogs, total] = await Promise.all([\n    prisma.dog.findMany({\n      where,\n      orderBy: [\n        { primaryPhotoUrl: 'desc' }, // Photos first\n        { createdAt: 'desc' }, // Then by recency\n      ],\n      take,\n      skip,\n      select: {\n        id: true,\n        name: true,\n        breed: true,\n        dateOfBirth: true,\n        bioPublic: true,\n        specialNeeds: true,\n        primaryPhotoUrl: true,\n        gender: true,\n        weight_lbs: true,\n        size: true,\n        mutt_id: true,\n        status: true,\n        createdAt: true,\n      },\n    }),\n    prisma.dog.count({ where }),\n  ]);\n\n  // Compute derived values on the fly\n  const dogsWithDerived = dogs.map(dog => ({\n    ...dog,\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n\n  return { dogs: dogsWithDerived, total };\n}\n\nexport async function getAvailableDogs({ page = 1, filters = {} }: { page?: number; filters?: DogFilters } = {}) {\n  const take = 12;\n  const skip = (Math.max(1, page) - 1) * take;\n\n  const where: Prisma.DogWhereInput = {\n    status: DogStatus.AVAILABLE,\n  };\n\n  if (filters.breed) {\n    where.breed = {\n      contains: filters.breed,\n      mode: \"insensitive\",\n    };\n  }\n\n  if (filters.size) {\n    where.size = filters.size as DogSize;\n  }\n\n  if (filters.gender) {\n    where.gender = filters.gender as Gender;\n  }\n\n\n  const specialNeedsFilter = coerceBoolean(filters.specialNeeds);\n  if (specialNeedsFilter !== undefined) {\n    where.specialNeeds = specialNeedsFilter;\n  }\n\n\n  const [dogs, totalCount] = await Promise.all([\n    prisma.dog.findMany({\n      where,\n      orderBy: [\n        { primaryPhotoUrl: 'desc' }, // Photos first\n        { createdAt: 'desc' }, // Then by recency\n      ],\n      take,\n      skip,\n      select: {\n        id: true,\n        name: true,\n        breed: true,\n        dateOfBirth: true,\n        bioPublic: true,\n        specialNeeds: true,\n        primaryPhotoUrl: true,\n        gender: true,\n        weight_lbs: true,\n        size: true,\n        mutt_id: true,\n        status: true,\n        createdAt: true,\n      },\n    }),\n    prisma.dog.count({ where }),\n  ]);\n\n  // Compute derived values on the fly\n  const dogsWithDerived = dogs.map(dog => ({\n    ...dog,\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n\n  const totalPages = Math.ceil(totalCount / take);\n\n  return {\n    dogs: dogsWithDerived,\n    pagination: {\n      page,\n      limit: take,\n      totalCount,\n      totalPages,\n      hasNextPage: page < totalPages,\n      hasPrevPage: page > 1,\n    },\n  };\n}\n\nexport async function getShelterDogs() {\n  const dogs = await prisma.dog.findMany({\n    where: {\n      status: {\n        not: \"ADOPTED\",\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n    select: {\n      id: true,\n      name: true,\n      breed: true,\n      dateOfBirth: true,\n      status: true,\n      primaryPhotoUrl: true,\n      createdAt: true,\n    },\n  });\n\n  // Compute derived values on the fly\n  return dogs.map(dog => ({\n    ...dog,\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n}\n\nexport async function getPotentialFosters() {\n  const fosterProfiles = await prisma.fosterProfile.findMany({\n    select: {\n      profileId: true,\n      profile: {\n        select: {\n          name: true,\n          email: true,\n        }\n      }\n    },\n    orderBy: [\n      {\n        profile: {\n          name: \"asc\",\n        },\n      },\n      {\n        profile: {\n          email: \"asc\",\n        },\n      },\n    ],\n  });\n\n  return fosterProfiles\n    .filter((fp) => fp.profile)\n    .map((fp) => ({\n      id: fp.profileId,\n      name: fp.profile?.name ?? null,\n      email: fp.profile?.email ?? \"\",\n    }));\n}\n\nexport async function getUniqueBreeds() {\n  const breeds = await prisma.dog.findMany({\n    where: { breed: { not: null } },\n    select: { breed: true },\n    distinct: ['breed'],\n    orderBy: { breed: 'asc' },\n  });\n  return [...new Set(breeds.map((b) => b.breed!).filter(Boolean))];\n}\n\nexport async function getUniqueStatuses() {\n  const statuses = await prisma.dog.findMany({\n    select: { status: true },\n    distinct: ['status'],\n  });\n  return [...new Set(statuses.map((s) => s.status))];\n}\n\nexport async function getUniqueGenders() {\n  const genders = await prisma.dog.findMany({\n    select: {\n      gender: true,\n    },\n    distinct: [\"gender\"],\n    orderBy: {\n      gender: \"asc\",\n    },\n  });\n\n  return genders\n    .map((entry) => entry.gender)\n    .filter((gender): gender is Gender => gender !== null);\n}\n\nexport async function getUniqueSizes() {\n  const sizes = await prisma.dog.findMany({\n    select: {\n      size: true,\n    },\n    distinct: [\"size\"],\n    orderBy: {\n      size: \"asc\",\n    },\n  });\n\n  return sizes\n    .map((entry) => entry.size)\n    .filter((size): size is DogSize => size !== null);\n}\n\nexport async function getRelatedDogs(dogId: number, limit = 4) {\n  // First get the current dog's size and dateOfBirth\n  const currentDog = await prisma.dog.findUnique({\n    where: { id: dogId },\n    select: { size: true, dateOfBirth: true },\n  });\n\n  if (!currentDog) {\n    return [];\n  }\n\n  // Calculate current dog's age\n  const currentAge = currentDog.dateOfBirth ? calculateAge(currentDog.dateOfBirth) : null;\n\n  // Get dogs with same size and similar age (2 years), excluding current dog\n  // Convert age range to date range: if current dog is X years old, find dogs born within 2 years of that age\n  const now = new Date();\n  const ageMin = Math.max(0, (currentAge || 0) - 2);\n  const ageMax = (currentAge || 0) + 2;\n\n  // Convert age range to date range (older dogs have earlier birth dates)\n  const dateMax = new Date(now.getTime() - ageMin * 365 * 24 * 60 * 60 * 1000);\n  const dateMin = new Date(now.getTime() - ageMax * 365 * 24 * 60 * 60 * 1000);\n\n  const dogs = await prisma.dog.findMany({\n    where: {\n      AND: [\n        { id: { not: dogId } },\n        { status: DogStatus.AVAILABLE },\n        { size: currentDog.size },\n        {\n          dateOfBirth: {\n            gte: dateMin,\n            lte: dateMax,\n          },\n        },\n      ],\n    },\n    orderBy: [\n      { primaryPhotoUrl: 'desc' }, // Photos first\n      { createdAt: 'desc' }, // Then by recency\n    ],\n    take: limit,\n    select: {\n      id: true,\n      name: true,\n      breed: true,\n      dateOfBirth: true,\n      bioPublic: true,\n      specialNeeds: true,\n      primaryPhotoUrl: true,\n      gender: true,\n      size: true,\n      status: true,\n      createdAt: true,\n    },\n  });\n\n  // Compute derived values on the fly\n  return dogs.map(dog => ({\n    ...dog,\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n}\n\nexport async function getAdoptedDogs() {\n  const dogs = await prisma.dog.findMany({\n    where: {\n      status: DogStatus.ADOPTED,\n    },\n    orderBy: {\n      updatedAt: \"desc\",\n    },\n    select: {\n      id: true,\n      name: true,\n      breed: true,\n      dateOfBirth: true,\n      bioPublic: true,\n      specialNeeds: true,\n      primaryPhotoUrl: true,\n      status: true,\n      createdAt: true,\n      updatedAt: true,\n    },\n  });\n\n  // Compute derived values on the fly\n  return dogs.map(dog => ({\n    ...dog,\n    isSenior: calculateAge(dog.dateOfBirth) ? calculateAge(dog.dateOfBirth)! >= 8 : false,\n    hasPhotos: dog.primaryPhotoUrl ? !dog.primaryPhotoUrl.includes('placeholder') : false,\n  }));\n}\n\n/**\n * Canonical function for fetching a dog with all its medical context.\n * Returns a consistent shape for both dog detail pages and medical-specific pages.\n */\nexport async function getDogMedicalBundle(dogId: number, page: number = 1) {\n  await assertRole(UserRole.STAFF);\n\n  const parsed = z.object({\n    dogId: z.coerce.number().int().positive(),\n    page: z.coerce.number().int().min(1)\n  }).safeParse({ dogId, page });\n  if (!parsed.success) {\n    throw new Error(\"Invalid dog ID\");\n  }\n\n  const [dogDetails, medicalRecords, medicalDocuments] = await Promise.all([\n    prisma.dog.findUnique({\n      where: { id: dogId },\n      include: {\n        fosterProfile: {\n          include: {\n            profile: true,\n          },\n        },\n      },\n    }),\n    getMedicalRecords(dogId, page),\n    getMedicalDocuments(dogId),\n  ]);\n\n  if (!dogDetails) {\n    throw new Error(\"Dog not found\");\n  }\n\n  // Compute derived values on the fly\n  const isSenior = calculateAge(dogDetails.dateOfBirth) ? calculateAge(dogDetails.dateOfBirth)! >= 8 : false;\n  const hasPhotos = dogDetails.primaryPhotoUrl ? !dogDetails.primaryPhotoUrl.includes('placeholder') : false;\n\n  return {\n    dog: {\n      ...dogDetails,\n      isSenior, // Runtime property\n      hasPhotos, // Runtime property\n    },\n    medicalRecords,\n    medicalDocuments,\n  };\n}\n\n/**\n * @deprecated Use getDogMedicalBundle instead for consistent medical data fetching\n * Fetches a single dog and its related data for the admin detail page.\n */\nexport async function getDogDetailsById(dogId: number) {\n  const bundle = await getDogMedicalBundle(dogId, 1);\n  return { dog: bundle.dog, medicalRecords: bundle.medicalRecords };\n}\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAG7B;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AAEA,MAAM,kBAAkB,kLAAC,CAAC,MAAM,CAAC;IAC/B,OAAO,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,CAAC;QAAE,SAAS;IAAiB;IACpE,QAAQ,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI;QAAE,SAAS;IAA6C,GAAG,GAAG,CAAC,MAAM;QAAE,SAAS;IAA2C;AACxJ;AAEA,MAAM,oBAAoB,kLAAC,CAAC,MAAM,CAAC;IACjC,OAAO,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,CAAC;QAAE,SAAS;IAAiB;AAEtE;AAEA,MAAM,mBAAmB,kLAAC,CAAC,MAAM,CAAC;IAChC,MAAM,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ,GAAG,OAAO,CAAC;IACxD,OAAO,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,QAAQ,GAAG,OAAO,CAAC;IAClE,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;WAAU,OAAO,MAAM,CAAC,0IAAS;KAAE,EAAE,QAAQ,GAAG,OAAO,CAAC;IACxE,iBAAiB,kLAAC,CAAC,IAAI,CAAC;QAAC,6IAAoB,CAAC,GAAG;QAAE,6IAAoB,CAAC,IAAI;KAAC,EAAE,EAAE,CAAC,kLAAC,CAAC,MAAM,IAAI,QAAQ,GAAG,OAAO,CAAC,6IAAoB,CAAC,GAAG;IACzI,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC;IACrC,QAAQ,kLAAC,CAAC,IAAI,CAAC;QAAC;WAAU,OAAO,MAAM,CAAC,uIAAM;KAAE,EAAE,QAAQ,GAAG,OAAO,CAAC;IACrE,MAAM,kLAAC,CAAC,IAAI,CAAC;QAAC;WAAU,OAAO,MAAM,CAAC,wIAAO;KAAE,EAAE,QAAQ,GAAG,OAAO,CAAC;IACpE,WAAW,kLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,SAAS;QAAE,SAAS;IAA0B,GAAG,QAAQ;IACrF,WAAW,kLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,SAAS;QAAE,SAAS;IAA0B,GAAG,QAAQ;IACrF,cAAc,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC;IAC5C,WAAW,kLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC;IACzC,WAAW,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAU;KAAQ,EAAE,QAAQ,GAAG,OAAO,CAAC;IAClE,eAAe,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAO;KAAO,EAAE,QAAQ,GAAG,OAAO,CAAC;AAC5D;AAEA,+BAA+B;AAC/B,eAAe,eAAe,IAAU;IACtC,MAAM,WAAW,MAAM,IAAA,yIAAY;IACnC,MAAM,YAAY,KAAK,GAAG;IAC1B,MAAM,oBAAoB,KAAK,IAAI,CAAC,OAAO,CAAC,QAAQ;IACpD,MAAM,cAAc,CAAC,IAAI,EAAE,UAAU,CAAC,EAAE,mBAAmB;IAE3D,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAClD,IAAI,CAAC,cACL,MAAM,CAAC,aAAa,MAAM;QACzB,QAAQ;IACV;IAEF,IAAI,aAAa;QACf,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,YAAY,OAAO,EAAE;IACzD;IAEA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,OAAO,CACvC,IAAI,CAAC,cACL,YAAY,CAAC;IAEhB,MAAM,YAAY,QAAQ,SAAS;IACnC,IAAI,CAAC,WAAW;QACd,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAEO,eAAe,UAAU,QAAkB;IAChD,IAAI;QACF,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;QAE/B,MAAM,SAAS,+IAAa,CAAC,SAAS,CAAC,OAAO,WAAW,CAAC,SAAS,OAAO;QAC1E,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,MAAM,cAAc,OAAO,KAAK,CAAC,OAAO,GAAG,WAAW;YACtD,OAAO;gBACL,SAAS;gBACT,SAAS;gBACT;gBACA,MAAM;YACR;QACF;QAEA,MAAM,EACJ,IAAI,EACJ,MAAM,EACN,KAAK,EACL,WAAW,EACX,SAAS,EACT,aAAa,EACb,eAAe,EACf,YAAY,EACb,GAAG,OAAO,IAAI;QAEf,MAAM,cAAc,UAAU,0IAAS,CAAC,MAAM;QAE9C,0CAA0C;QAC1C,IAAI,kBAAkB,0CAA0C,sBAAsB;QACtF,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,gBAAgB,QAAQ,KAAK,IAAI,GAAG,GAAG;YACzC,IAAI;gBACF,kBAAkB,MAAM,eAAe;YACzC,EAAE,OAAO,OAAO;gBACd,uEAAuE;gBACvE,2DAA2D;gBAC3D,QAAQ,KAAK,CAAC,+BAA+B;YAC/C;QACF;QAEA,MAAM,mHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;YACtB,MAAM;gBACJ;gBACA,QAAQ;gBACR;gBACA;gBACA;gBACA;gBACA;gBACA,iBAAiB,gBAAgB,0IAAS,CAAC,SAAS,GAAG,kBAAkB;gBACzE;YACF;QACF;QAEA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC;QACf,IAAA,iMAAQ,EAAC;IACX,EAAE,OAAO,OAAO;QACd,OAAO;YACL,SAAS;YACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,aAAa;YACb,MAAM;QACR;IACF;AACF;AAEO,eAAe,UAAU,KAAa,EAAE,QAAkB;IAC/D,IAAI;QACF,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;QAC/B,MAAM,SAAS,MAAM,IAAA,sJAAgB;QAErC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,IAAI,cAAkC;QAEtC,IAAI,QAAQ,KAAK,IAAI,GAAG,GAAG;YACzB,IAAI;gBACF,cAAc,MAAM,eAAe;YACrC,EAAE,OAAO,OAAO;gBACd,OAAO;oBACL,SAAS;oBACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;oBAClD,aAAa;oBACb,MAAM;gBACR;YACF;QACF;QAEA,MAAM,SAAS,+IAAa,CAAC,SAAS,CAAC,OAAO,WAAW,CAAC,SAAS,OAAO;QAC1E,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,MAAM,cAAc,OAAO,KAAK,CAAC,OAAO,GAAG,WAAW;YACtD,OAAO;gBACL,SAAS;gBACT,SAAS;gBACT;gBACA,MAAM;YACR;QACF;QAEA,MAAM,EACJ,IAAI,EACJ,MAAM,EACN,KAAK,EACL,WAAW,EACX,SAAS,EACT,aAAa,EACb,eAAe,EACf,YAAY,EACb,GAAG,OAAO,IAAI;QAEf,MAAM,cAAc,UAAU,0IAAS,CAAC,MAAM;QAE9C,iCAAiC;QACjC,MAAM,cAAc,MAAM,IAAA,uJAAiB,EAAC,OAAO;QAEnD,MAAM,aAUF;YACF;YACA,QAAQ;YACR;YACA;YACA;YACA;YACA;YACA,iBAAiB,gBAAgB,0IAAS,CAAC,SAAS,GAAG,kBAAkB;QAC3E;QAEA,IAAI,aAAa;YACf,WAAW,eAAe,GAAG;QAC/B;QAEA,MAAM,IAAA,+IAAS,EACb,aACA,QACA;YACE,MAAM,aAAa,MAAM,mHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;gBACzC,OAAO;oBAAE,IAAI;gBAAM;gBACnB,MAAM;YACR;YAEA,IAAA,+IAAc,EAAC;YACf,IAAA,+IAAc,EAAC,CAAC,gBAAgB,EAAE,OAAO;YACzC,IAAA,+IAAc,EAAC;YACf,IAAA,+IAAc,EAAC,CAAC,OAAO,EAAE,OAAO;YAEhC,OAAO;QACT,GACA;YACE,QAAQ,4IAAW,CAAC,QAAQ;YAC5B,YAAY;YACZ,UAAU;YACV,QAAQ,eAAe;YACvB,OAAO,cAAc;gBAAE,GAAG,WAAW;gBAAE,GAAG,UAAU;YAAC,IAAI;YACzD,MAAM,CAAC,aAAa,EAAE,MAAM;QAC9B;QAGF,OAAO;YACL,SAAS;YACT,SAAS;YACT,aAAa;YACb,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,OAAO;YACL,SAAS;YACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,aAAa;YACb,MAAM;QACR;IACF;AACF;AAEO,eAAe,qBAAqB,SAAiE,EAAE,QAAkB;IAC9H,IAAI;QACF,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;IACjC,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAAkB,aAAa;QAAK;IACjG;IAEA,MAAM,SAAS,kBAAkB,SAAS,CAAC,OAAO,WAAW,CAAC,SAAS,OAAO;IAC9E,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO;YAAE,SAAS,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,MAAM,OAAO,EAAE,EAAE,IAAI,CAAC;YAAO,aAAa;QAAK;IAChI;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,OAAO,IAAI;IAC7B,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,GAAG;QAC5B,OAAO;YAAE,SAAS;YAAqB,aAAa;QAAK;IAC3D;IAEA,MAAM,WAAW,MAAM,IAAA,yIAAY;IACnC,MAAM,WAAW,CAAC,KAAK,EAAE,MAAM,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI;IAE3D,IAAI;QACF,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,OAAO,CAClD,IAAI,CAAC,UAAU,iDAAiD;SAChE,MAAM,CAAC,UAAU;QAEpB,IAAI,aAAa;YACf,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,YAAY,OAAO,EAAE;QACzD;QAEA,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,GAAG,SAAS,OAAO,CAC7C,IAAI,CAAC,UACL,YAAY,CAAC;QAEhB,IAAI,CAAC,WAAW;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,mHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;YACtB,OAAO;gBAAE,IAAI;YAAM;YACnB,MAAM;gBAAE,iBAAiB;YAAU;QACrC;QAEA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC,CAAC,gBAAgB,EAAE,OAAO;QACzC,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC,CAAC,OAAO,EAAE,OAAO;QAEhC,OAAO;YAAE,SAAS;YAAM,aAAa;QAAU;IAEjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO;YAAE,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAAkB,aAAa;QAAK;IACjG;AACF;AAEO,eAAe,UAAU,KAAa,EAAE,MAAc;IAC3D,IAAI;QACF,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;QAC/B,MAAM,SAAS,MAAM,IAAA,sJAAgB;QAErC,MAAM,SAAS,gBAAgB,SAAS,CAAC;YAAE;YAAO;QAAO;QACzD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,MAAM,cAAc,OAAO,KAAK,CAAC,OAAO,GAAG,WAAW;YACtD,OAAO;gBACL,SAAS;gBACT,SAAS;gBACT;gBACA,MAAM;YACR;QACF;QAEA,iCAAiC;QACjC,MAAM,cAAc,MAAM,IAAA,uJAAiB,EAAC,OAAO,OAAO,IAAI,CAAC,KAAK;QAEpE,MAAM,IAAA,+IAAS,EACb,aACA,QACA;YACE,MAAM,mHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;gBAAE,OAAO;oBAAE,IAAI,OAAO,IAAI,CAAC,KAAK;gBAAC;YAAE;YAC3D,IAAA,+IAAc,EAAC;YACf,IAAA,+IAAc,EAAC;YACf,OAAO;QACT,GACA;YACE,QAAQ,4IAAW,CAAC,QAAQ;YAC5B,YAAY;YACZ,UAAU,OAAO,IAAI,CAAC,KAAK;YAC3B,QAAQ,eAAe;YACvB,OAAO;YACP,MAAM,CAAC,qBAAqB,EAAE,OAAO,IAAI,CAAC,MAAM,EAAE;QACpD;QAGF,OAAO;YACL,SAAS;YACT,SAAS;YACT,aAAa;YACb,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,OAAO;YACL,SAAS;YACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,aAAa;YACb,MAAM;QACR;IACF;AACF;AAEO,eAAe,WAAW,EAAU;IACzC,MAAM,SAAS,kLAAC,CAAC,MAAM,CAAC;QAAE,IAAI,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IAAG,GAAG,SAAS,CAAC;QAAE;IAAG;IACnF,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,MAAM,MAAM,mHAAM,CAAC,GAAG,CAAC,UAAU,CAAC;QACtC,OAAO;YAAE;QAAG;QACZ,SAAS;YACP,eAAe;gBACb,QAAQ;oBACN,WAAW;oBACX,SAAS;wBACP,QAAQ;4BACN,MAAM;4BACN,OAAO;wBACT;oBACF;gBACF;YACF;QACF;IACF;IAEA,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IAEA,oCAAoC;IACpC,MAAM,WAAW,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;IACvF,MAAM,YAAY,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;IAEvF,OAAO;QACL,GAAG,GAAG;QACN;QACA;IACF;AACF;AAEO,eAAe,WAAW,YAAoD;IACnF,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;IAE/B,MAAM,SAAS,iBAAiB,SAAS,CAAC,gBAAgB,CAAC;IAC3D,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,OAAO,IAAI;IACnC,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;IAE5B,mCAAmC;IACnC,MAAM,QAA8B,CAAC;IAErC,IAAI,OAAO,IAAI,CAAC,MAAM,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,OAAO;QACtD,MAAM,MAAM,GAAG,OAAO,IAAI,CAAC,MAAM;IACnC;IAEA,IAAI,OAAO,IAAI,CAAC,eAAe,IAAI,OAAO,IAAI,CAAC,eAAe,KAAK,6IAAoB,CAAC,GAAG,EAAE;QAC3F,IAAI,OAAO,IAAI,CAAC,eAAe,KAAK,6IAAoB,CAAC,IAAI,EAAE;YAC7D,0CAA0C;YAC1C,MAAM,eAAe,GAAG;QAC1B,OAAO;YACL,6BAA6B;YAC7B,MAAM,eAAe,GAAG,OAAO,IAAI,CAAC,eAAe;QACrD;IACF;IAEA,IAAI,OAAO,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,SAAS,OAAO,IAAI,CAAC,KAAK,KAAK,IAAI;QAChF,MAAM,KAAK,GAAG;YACZ,UAAU,OAAO,IAAI,CAAC,KAAK;YAC3B,MAAM;QACR;IACF;IAEA,IAAI,OAAO,IAAI,CAAC,MAAM,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,OAAO;QACtD,MAAM,MAAM,GAAG,OAAO,IAAI,CAAC,MAAM;IACnC;IAEA,IAAI,OAAO,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,OAAO;QAClD,MAAM,IAAI,GAAG,OAAO,IAAI,CAAC,IAAI;IAC/B;IAEA,IAAI,OAAO,IAAI,CAAC,SAAS,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,IAAI;QACzD,MAAM,YAAY,SAAS,OAAO,IAAI,CAAC,SAAS,EAAE;QAClD,IAAI,CAAC,OAAO,KAAK,CAAC,YAAY;YAC5B,MAAM,UAAU,GAAG;gBAAE,KAAK;YAAU;QACtC;IACF;IAEA,IAAI,OAAO,IAAI,CAAC,SAAS,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,IAAI;QACzD,MAAM,YAAY,SAAS,OAAO,IAAI,CAAC,SAAS,EAAE;QAClD,IAAI,CAAC,OAAO,KAAK,CAAC,YAAY;YAC5B,MAAM,UAAU,GAAG,MAAM,UAAU,GAAG;gBAAE,GAAI,MAAM,UAAU;gBAAa,KAAK;YAAU,IAAI;gBAAE,KAAK;YAAU;QAC/G;IACF;IAGA,IAAI,OAAO,IAAI,CAAC,YAAY,IAAI,OAAO,IAAI,CAAC,YAAY,KAAK,OAAO;QAClE,MAAM,YAAY,GAAG,OAAO,IAAI,CAAC,YAAY,KAAK;IACpD;IAEA,IAAI,OAAO,IAAI,CAAC,SAAS,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,OAAO;QAC5D,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ;YACpC,MAAM,eAAe,GAAG;gBAAE,KAAK;YAAK;QACtC,OAAO;YACL,MAAM,eAAe,GAAG;QAC1B;IACF;IAEA,mCAAmC;IACnC,MAAM,UAA8C,CAAC;IACrD,MAAM,YAAY,OAAO,IAAI,CAAC,SAAS;IACvC,MAAM,gBAAgB,OAAO,IAAI,CAAC,aAAa;IAE/C,OAAQ;QACN,KAAK;YACH,QAAQ,IAAI,GAAG;YACf;QACF,KAAK;YACH,QAAQ,MAAM,GAAG;YACjB;QACF,KAAK;YACH,QAAQ,KAAK,GAAG;YAChB;QACF;YACE,QAAQ,IAAI,GAAG;IACnB;IAEA,MAAM,CAAC,MAAM,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;QAC3C,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;YAClB;YACA;YACA,MAAM;YACN,MAAM;YACN,QAAQ;gBACN,IAAI;gBACJ,SAAS;gBACT,MAAM;gBACN,OAAO;gBACP,aAAa;gBACb,QAAQ;gBACR,iBAAiB;gBACjB,QAAQ;gBACR,YAAY;gBACZ,MAAM;gBACN,cAAc;gBACd,WAAW;gBACX,WAAW;gBACX,eAAe;oBACb,QAAQ;wBACN,SAAS;4BACP,QAAQ;gCACN,MAAM;gCACN,OAAO;4BACT;wBACF;oBACF;gBACF;YACF;QACF;QACA,mHAAM,CAAC,GAAG,CAAC,KAAK,CAAC;YAAE;QAAM;KAC1B;IAED,MAAM,aAAa,KAAK,IAAI,CAAC,aAAa;IAE1C,yDAAyD;IACzD,MAAM,0BAA0B,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YAC/C,GAAG,GAAG;YACN,eAAe,IAAI,aAAa,GAAG;gBACjC,GAAG,IAAI,aAAa;gBACpB,MAAM,IAAI,aAAa,CAAC,OAAO,EAAE;gBACjC,OAAO,IAAI,aAAa,CAAC,OAAO,EAAE;YACpC,IAAI;YACJ,oCAAoC;YACpC,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;IAED,OAAO;QACL,MAAM;QACN,YAAY;YACV,aAAa;YACb;YACA;YACA,aAAa,OAAO;YACpB,iBAAiB,OAAO;QAC1B;IACF;AACF;AAUA,MAAM,gBAAgB,CAAC;IACrB,IAAI,UAAU,WAAW,OAAO;IAChC,IAAI,UAAU,QAAQ,OAAO;IAC7B,IAAI,UAAU,SAAS,OAAO;IAC9B,OAAO;AACT;AAEO,eAAe,QAAQ,EAAE,OAAO,CAAC,EAAE,WAAW,EAAE,EAAwC,GAAG,CAAC,CAAC;IAClG,MAAM,OAAO;IACb,MAAM,OAAO,CAAC,KAAK,GAAG,CAAC,GAAG,QAAQ,CAAC,IAAI;IAEvC,MAAM,QAA8B;QAClC,QAAQ,0IAAS,CAAC,SAAS;IAC7B;IAEA,MAAM,CAAC,MAAM,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;QACtC,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;YAClB;YACA,SAAS;gBACP;oBAAE,iBAAiB;gBAAO;gBAC1B;oBAAE,WAAW;gBAAO;aACrB;YACD;YACA;YACA,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,iBAAiB;gBACjB,QAAQ;gBACR,YAAY;gBACZ,MAAM;gBACN,SAAS;gBACT,QAAQ;gBACR,WAAW;YACb;QACF;QACA,mHAAM,CAAC,GAAG,CAAC,KAAK,CAAC;YAAE;QAAM;KAC1B;IAED,oCAAoC;IACpC,MAAM,kBAAkB,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACvC,GAAG,GAAG;YACN,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;IAED,OAAO;QAAE,MAAM;QAAiB;IAAM;AACxC;AAEO,eAAe,iBAAiB,EAAE,OAAO,CAAC,EAAE,UAAU,CAAC,CAAC,EAA2C,GAAG,CAAC,CAAC;IAC7G,MAAM,OAAO;IACb,MAAM,OAAO,CAAC,KAAK,GAAG,CAAC,GAAG,QAAQ,CAAC,IAAI;IAEvC,MAAM,QAA8B;QAClC,QAAQ,0IAAS,CAAC,SAAS;IAC7B;IAEA,IAAI,QAAQ,KAAK,EAAE;QACjB,MAAM,KAAK,GAAG;YACZ,UAAU,QAAQ,KAAK;YACvB,MAAM;QACR;IACF;IAEA,IAAI,QAAQ,IAAI,EAAE;QAChB,MAAM,IAAI,GAAG,QAAQ,IAAI;IAC3B;IAEA,IAAI,QAAQ,MAAM,EAAE;QAClB,MAAM,MAAM,GAAG,QAAQ,MAAM;IAC/B;IAGA,MAAM,qBAAqB,cAAc,QAAQ,YAAY;IAC7D,IAAI,uBAAuB,WAAW;QACpC,MAAM,YAAY,GAAG;IACvB;IAGA,MAAM,CAAC,MAAM,WAAW,GAAG,MAAM,QAAQ,GAAG,CAAC;QAC3C,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;YAClB;YACA,SAAS;gBACP;oBAAE,iBAAiB;gBAAO;gBAC1B;oBAAE,WAAW;gBAAO;aACrB;YACD;YACA;YACA,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,iBAAiB;gBACjB,QAAQ;gBACR,YAAY;gBACZ,MAAM;gBACN,SAAS;gBACT,QAAQ;gBACR,WAAW;YACb;QACF;QACA,mHAAM,CAAC,GAAG,CAAC,KAAK,CAAC;YAAE;QAAM;KAC1B;IAED,oCAAoC;IACpC,MAAM,kBAAkB,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACvC,GAAG,GAAG;YACN,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;IAED,MAAM,aAAa,KAAK,IAAI,CAAC,aAAa;IAE1C,OAAO;QACL,MAAM;QACN,YAAY;YACV;YACA,OAAO;YACP;YACA;YACA,aAAa,OAAO;YACpB,aAAa,OAAO;QACtB;IACF;AACF;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACrC,OAAO;YACL,QAAQ;gBACN,KAAK;YACP;QACF;QACA,SAAS;YACP,WAAW;QACb;QACA,QAAQ;YACN,IAAI;YACJ,MAAM;YACN,OAAO;YACP,aAAa;YACb,QAAQ;YACR,iBAAiB;YACjB,WAAW;QACb;IACF;IAEA,oCAAoC;IACpC,OAAO,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACtB,GAAG,GAAG;YACN,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;AACH;AAEO,eAAe;IACpB,MAAM,iBAAiB,MAAM,mHAAM,CAAC,aAAa,CAAC,QAAQ,CAAC;QACzD,QAAQ;YACN,WAAW;YACX,SAAS;gBACP,QAAQ;oBACN,MAAM;oBACN,OAAO;gBACT;YACF;QACF;QACA,SAAS;YACP;gBACE,SAAS;oBACP,MAAM;gBACR;YACF;YACA;gBACE,SAAS;oBACP,OAAO;gBACT;YACF;SACD;IACH;IAEA,OAAO,eACJ,MAAM,CAAC,CAAC,KAAO,GAAG,OAAO,EACzB,GAAG,CAAC,CAAC,KAAO,CAAC;YACZ,IAAI,GAAG,SAAS;YAChB,MAAM,GAAG,OAAO,EAAE,QAAQ;YAC1B,OAAO,GAAG,OAAO,EAAE,SAAS;QAC9B,CAAC;AACL;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACvC,OAAO;YAAE,OAAO;gBAAE,KAAK;YAAK;QAAE;QAC9B,QAAQ;YAAE,OAAO;QAAK;QACtB,UAAU;YAAC;SAAQ;QACnB,SAAS;YAAE,OAAO;QAAM;IAC1B;IACA,OAAO;WAAI,IAAI,IAAI,OAAO,GAAG,CAAC,CAAC,IAAM,EAAE,KAAK,EAAG,MAAM,CAAC;KAAU;AAClE;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACzC,QAAQ;YAAE,QAAQ;QAAK;QACvB,UAAU;YAAC;SAAS;IACtB;IACA,OAAO;WAAI,IAAI,IAAI,SAAS,GAAG,CAAC,CAAC,IAAM,EAAE,MAAM;KAAG;AACpD;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACxC,QAAQ;YACN,QAAQ;QACV;QACA,UAAU;YAAC;SAAS;QACpB,SAAS;YACP,QAAQ;QACV;IACF;IAEA,OAAO,QACJ,GAAG,CAAC,CAAC,QAAU,MAAM,MAAM,EAC3B,MAAM,CAAC,CAAC,SAA6B,WAAW;AACrD;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACtC,QAAQ;YACN,MAAM;QACR;QACA,UAAU;YAAC;SAAO;QAClB,SAAS;YACP,MAAM;QACR;IACF;IAEA,OAAO,MACJ,GAAG,CAAC,CAAC,QAAU,MAAM,IAAI,EACzB,MAAM,CAAC,CAAC,OAA0B,SAAS;AAChD;AAEO,eAAe,eAAe,KAAa,EAAE,QAAQ,CAAC;IAC3D,mDAAmD;IACnD,MAAM,aAAa,MAAM,mHAAM,CAAC,GAAG,CAAC,UAAU,CAAC;QAC7C,OAAO;YAAE,IAAI;QAAM;QACnB,QAAQ;YAAE,MAAM;YAAM,aAAa;QAAK;IAC1C;IAEA,IAAI,CAAC,YAAY;QACf,OAAO,EAAE;IACX;IAEA,8BAA8B;IAC9B,MAAM,aAAa,WAAW,WAAW,GAAG,IAAA,4IAAY,EAAC,WAAW,WAAW,IAAI;IAEnF,4EAA4E;IAC5E,6GAA6G;IAC7G,MAAM,MAAM,IAAI;IAChB,MAAM,SAAS,KAAK,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI;IAC/C,MAAM,SAAS,CAAC,cAAc,CAAC,IAAI;IAEnC,wEAAwE;IACxE,MAAM,UAAU,IAAI,KAAK,IAAI,OAAO,KAAK,SAAS,MAAM,KAAK,KAAK,KAAK;IACvE,MAAM,UAAU,IAAI,KAAK,IAAI,OAAO,KAAK,SAAS,MAAM,KAAK,KAAK,KAAK;IAEvE,MAAM,OAAO,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACrC,OAAO;YACL,KAAK;gBACH;oBAAE,IAAI;wBAAE,KAAK;oBAAM;gBAAE;gBACrB;oBAAE,QAAQ,0IAAS,CAAC,SAAS;gBAAC;gBAC9B;oBAAE,MAAM,WAAW,IAAI;gBAAC;gBACxB;oBACE,aAAa;wBACX,KAAK;wBACL,KAAK;oBACP;gBACF;aACD;QACH;QACA,SAAS;YACP;gBAAE,iBAAiB;YAAO;YAC1B;gBAAE,WAAW;YAAO;SACrB;QACD,MAAM;QACN,QAAQ;YACN,IAAI;YACJ,MAAM;YACN,OAAO;YACP,aAAa;YACb,WAAW;YACX,cAAc;YACd,iBAAiB;YACjB,QAAQ;YACR,MAAM;YACN,QAAQ;YACR,WAAW;QACb;IACF;IAEA,oCAAoC;IACpC,OAAO,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACtB,GAAG,GAAG;YACN,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;AACH;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,mHAAM,CAAC,GAAG,CAAC,QAAQ,CAAC;QACrC,OAAO;YACL,QAAQ,0IAAS,CAAC,OAAO;QAC3B;QACA,SAAS;YACP,WAAW;QACb;QACA,QAAQ;YACN,IAAI;YACJ,MAAM;YACN,OAAO;YACP,aAAa;YACb,WAAW;YACX,cAAc;YACd,iBAAiB;YACjB,QAAQ;YACR,WAAW;YACX,WAAW;QACb;IACF;IAEA,oCAAoC;IACpC,OAAO,KAAK,GAAG,CAAC,CAAA,MAAO,CAAC;YACtB,GAAG,GAAG;YACN,UAAU,IAAA,4IAAY,EAAC,IAAI,WAAW,IAAI,IAAA,4IAAY,EAAC,IAAI,WAAW,KAAM,IAAI;YAChF,WAAW,IAAI,eAAe,GAAG,CAAC,IAAI,eAAe,CAAC,QAAQ,CAAC,iBAAiB;QAClF,CAAC;AACH;AAMO,eAAe,oBAAoB,KAAa,EAAE,OAAe,CAAC;IACvE,MAAM,IAAA,kJAAU,EAAC,yIAAQ,CAAC,KAAK;IAE/B,MAAM,SAAS,kLAAC,CAAC,MAAM,CAAC;QACtB,OAAO,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;QACvC,MAAM,kLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;IACpC,GAAG,SAAS,CAAC;QAAE;QAAO;IAAK;IAC3B,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,CAAC,YAAY,gBAAgB,iBAAiB,GAAG,MAAM,QAAQ,GAAG,CAAC;QACvE,mHAAM,CAAC,GAAG,CAAC,UAAU,CAAC;YACpB,OAAO;gBAAE,IAAI;YAAM;YACnB,SAAS;gBACP,eAAe;oBACb,SAAS;wBACP,SAAS;oBACX;gBACF;YACF;QACF;QACA,IAAA,yJAAiB,EAAC,OAAO;QACzB,IAAA,2JAAmB,EAAC;KACrB;IAED,IAAI,CAAC,YAAY;QACf,MAAM,IAAI,MAAM;IAClB;IAEA,oCAAoC;IACpC,MAAM,WAAW,IAAA,4IAAY,EAAC,WAAW,WAAW,IAAI,IAAA,4IAAY,EAAC,WAAW,WAAW,KAAM,IAAI;IACrG,MAAM,YAAY,WAAW,eAAe,GAAG,CAAC,WAAW,eAAe,CAAC,QAAQ,CAAC,iBAAiB;IAErG,OAAO;QACL,KAAK;YACH,GAAG,UAAU;YACb;YACA;QACF;QACA;QACA;IACF;AACF;AAMO,eAAe,kBAAkB,KAAa;IACnD,MAAM,SAAS,MAAM,oBAAoB,OAAO;IAChD,OAAO;QAAE,KAAK,OAAO,GAAG;QAAE,gBAAgB,OAAO,cAAc;IAAC;AAClE;;;IAz3BsB;IAqEA;IAmHA;IAwDA;IAsDA;IAsCA;IAsKA;IA8CA;IAgFA;IA6BA;IAkCA;IAUA;IAQA;IAgBA;IAgBA;IAkEA;IAkCA;IAiDA;;AAt3BA,+OAAA;AAqEA,+OAAA;AAmHA,+OAAA;AAwDA,+OAAA;AAsDA,+OAAA;AAsCA,+OAAA;AAsKA,+OAAA;AA8CA,+OAAA;AAgFA,+OAAA;AA6BA,+OAAA;AAkCA,+OAAA;AAUA,+OAAA;AAQA,+OAAA;AAgBA,+OAAA;AAgBA,+OAAA;AAkEA,+OAAA;AAkCA,+OAAA;AAiDA,+OAAA","debugId":null}},
    {"offset": {"line": 2806, "column": 0}, "map": {"version":3,"sources":["file:///Users/adampeterson/Github/mutts/.next-internal/server/app/adopt/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getShelterDogs as '000a10a8c48a2ee52ab05f736a025f0fc3430ed087'} from 'ACTIONS_MODULE0'\nexport {getUniqueBreeds as '0019079e818e55751763ff78fc8ff027e9229acf81'} from 'ACTIONS_MODULE0'\nexport {getPotentialFosters as '00636a5f955c055d9ae7354b912740525bc095ed8a'} from 'ACTIONS_MODULE0'\nexport {getUniqueStatuses as '008eeddbd6b4383f36b57519240b05cda72ffd3c35'} from 'ACTIONS_MODULE0'\nexport {getUniqueSizes as '0096a4418a44c207c9e46a0d0ea49723f0f5beafc6'} from 'ACTIONS_MODULE0'\nexport {getAdoptedDogs as '00ed911e85835f38bef24e726e75a3ce65626bc191'} from 'ACTIONS_MODULE0'\nexport {getUniqueGenders as '00f408ca64ac5f31f6d33edb3fac1af6d3c4ec2139'} from 'ACTIONS_MODULE0'\nexport {getDogs as '4000b6ce4b2fec5adc2908e05c9e975ec1809e896c'} from 'ACTIONS_MODULE0'\nexport {getDogDetailsById as '401755ca459dee27048e5cb1b2a37b68009c1a4264'} from 'ACTIONS_MODULE0'\nexport {getDogById as '408f99a89cce2e13a05568db8eaa3b51e83e52cdfe'} from 'ACTIONS_MODULE0'\nexport {getAvailableDogs as '40cafae7f99e5ce12881510a297b1881d628c95439'} from 'ACTIONS_MODULE0'\nexport {getAllDogs as '40d4e8ed5df4b988b285b21be257cde22439748fb0'} from 'ACTIONS_MODULE0'\nexport {createDog as '40fc9b3430fa18ec08c7b11c01dade07f8ea8fad1a'} from 'ACTIONS_MODULE0'\nexport {deleteDog as '6033c3740bfb39b1d88f5bc1d4d6032abe7989c415'} from 'ACTIONS_MODULE0'\nexport {getRelatedDogs as '607872d570086e997fa69c526f8b345ef1ac31b02c'} from 'ACTIONS_MODULE0'\nexport {getDogMedicalBundle as '6078f096910cca9f1b04ed2bc37d4889f49c930d80'} from 'ACTIONS_MODULE0'\nexport {uploadAndSetDogImage as '6086ab75672e1233c1297a8296353e983681f5690e'} from 'ACTIONS_MODULE0'\nexport {updateDog as '60fe0a92564fcd68752aa0323d2abaea7708f4c303'} from 'ACTIONS_MODULE0'\nexport {getAllStaffUsers as '0033a4aab8087bee60fa3957be6e412e7a28e6b142'} from 'ACTIONS_MODULE1'\nexport {getAllUsers as '0040745eebb8809dbc98afe0103726da3438000754'} from 'ACTIONS_MODULE1'\nexport {getActingUserRole as '006095df662d1f5454db62806f7d257b4264768061'} from 'ACTIONS_MODULE1'\nexport {getUserProfile as '40103a556ce1c8f26a74594d1623582c17a19007fe'} from 'ACTIONS_MODULE1'\nexport {requireRole as '401918a5b31d808cec1006f2b7ec1ed729ea95edbe'} from 'ACTIONS_MODULE1'\nexport {createProfile as '4029bb82f3e859aa7d1d5c000b17516a82e1704167'} from 'ACTIONS_MODULE1'\nexport {assertRole as '4058e90462fbf4a2c11008bad52cf288efe05a8b32'} from 'ACTIONS_MODULE1'\nexport {getActingUser as '40b6b27014bdc1a8fded8ff3d22be5fda4813317de'} from 'ACTIONS_MODULE1'\nexport {getUserSignupIds as '40c005c7807d025045aa1b80a1ad40fa0d179df6e8'} from 'ACTIONS_MODULE1'\nexport {updateUserRole as '60ceabe90fc8ed1b25017daee808de48043d157a6e'} from 'ACTIONS_MODULE1'\nexport {getCurrentUserId as '00842318b15abb8899f8a126d649c3887e25bc26dd'} from 'ACTIONS_MODULE2'\nexport {captureAuditState as '60e65605f915ad978cc1eff7d71f6bc5ae162e6026'} from 'ACTIONS_MODULE2'\nexport {withAudit as '784b13a691424b9961dce89e697a2618dca525da25'} from 'ACTIONS_MODULE2'\nexport {logDogAudit as '784b3fb4320f38bcac735db6d70fae03d038f392f6'} from 'ACTIONS_MODULE2'\nexport {logApplicationAudit as '78ed9814381cdb54d982538f79494c008b83c58d6f'} from 'ACTIONS_MODULE2'\nexport {createMedicalRecord as '40287cd94b9cff320c8e99fba57a6d56392f11e4f0'} from 'ACTIONS_MODULE3'\nexport {getMedicalDocuments as '40d921d941a2041ebc5c9eff88111fc3bfe7944b41'} from 'ACTIONS_MODULE3'\nexport {updateMedicalRecord as '600766ba61c2c48d02f4c6100c955c1b192d033ed2'} from 'ACTIONS_MODULE3'\nexport {deleteMedicalRecord as '601b63255f8808b6a72067724602b72547a1847b6a'} from 'ACTIONS_MODULE3'\nexport {uploadMedicalDocument as '602b36ee92de0293b9d04aff8a21372f53586771ae'} from 'ACTIONS_MODULE3'\nexport {deleteMedicalDocument as '60e959ce08ff833f9a37b6a6da493f13faac95dfd1'} from 'ACTIONS_MODULE3'\nexport {getMedicalRecords as '70ce82ca5043bbade27dded89d6e9542f4283b5ee4'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":";AAAA;AAkBA;AAUA;AAKA","debugId":null}}]
}